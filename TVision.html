<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
<meta http-equiv="Content-Security-Policy" 
      content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;
               script-src * 'unsafe-inline' 'unsafe-eval';
               connect-src * 'unsafe-inline';
               style-src * 'unsafe-inline';
               img-src * data: blob: 'unsafe-inline';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Player</title>
    <style>
        /* ===== ESTILOS DEL EFECTO DE PRESENTACI√ìN ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000; /* Fondo negro puro para AMOLED */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: white;
        }

        .splash-container {
            text-align: center;
            z-index: 10;
            position: relative;
            max-width: 800px;
            padding: 20px;
            opacity: 0;
            animation: fadeIn 1.5s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .floating-image {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.8);
            animation: float 6s ease-in-out infinite;
            border: 8px solid rgba(255, 255, 255, 0.1);
        }

        .floating-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(1.1) contrast(1.1);
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
            font-weight: 700;
            background: linear-gradient(90deg, #00FF88, #FF2A6D, #00D9FF);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
        }

        .tagline {
            font-size: 1.5rem;
            margin-bottom: 30px;
            font-weight: 300;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.8);
            color: #e0e0e0;
        }

        .description {
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto 30px;
            line-height: 1.6;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.8);
            color: #c0c0c0;
        }

        .features {
            text-align: left;
            max-width: 500px;
            margin: 0 auto 30px;
            background: rgba(30, 30, 30, 0.8); /* Fondo oscuro para AMOLED */
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .features h3 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.3rem;
            color: #00FF88;
        }

        .features ul {
            list-style-type: none;
        }

        .features li {
            padding: 8px 0;
            position: relative;
            padding-left: 25px;
            color: #e0e0e0;
        }

        .features li:before {
            content: "‚Ä¢";
            color: #00FF88;
            font-size: 1.5rem;
            position: absolute;
            left: 0;
            top: 3px;
        }

        .final-message {
            font-size: 1.3rem;
            font-weight: 600;
            margin-top: 20px;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.8);
            color: #ffffff;
        }

        .slogan {
            font-size: 1.1rem;
            font-style: italic;
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.7);
        }

        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .particle {
            position: absolute;
            background: rgba(0, 255, 136, 0.3); /* Color verde vibrante para AMOLED */
            border-radius: 50%;
            animation: particle-float 15s infinite linear;
        }

        @keyframes particle-float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .mountain-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #000000 0%, #0a0a2a 40%, #1a1a4a 70%, #2a2a6a 100%);
            z-index: 0;
        }

        .mountain-range {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40%;
            background: linear-gradient(to top, #000000 0%, #1a1a1a 30%, #2a2a2a 60%, #3a3a3a 100%);
            clip-path: polygon(0% 100%, 10% 70%, 20% 90%, 30% 60%, 40% 80%, 50% 50%, 60% 70%, 70% 40%, 80% 60%, 90% 30%, 100% 100%);
        }

        .mountain-range:nth-child(2) {
            height: 30%;
            background: linear-gradient(to top, #000000 0%, #0a0a1a 30%, #1a1a2a 60%, #2a2a3a 100%);
            clip-path: polygon(0% 100%, 5% 80%, 15% 60%, 25% 90%, 35% 70%, 45% 100%, 55% 80%, 65% 60%, 75% 90%, 85% 70%, 95% 50%, 100% 100%);
            z-index: -1;
        }

        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .star {
            position: absolute;
            background-color: #ffffff;
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        .loading-bar {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin: 30px auto;
            overflow: hidden;
        }

        .loading-progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #00FF88, #FF2A6D);
            border-radius: 2px;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .loading-text {
            font-size: 0.9rem;
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* ===== ESTILOS PARA OCULTAR LA APLICACI√ìN INICIALMENTE ===== */
        #app-container {
            display: none;
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <!-- ===== EFECTO DE PRESENTACI√ìN ===== -->
    <div class="mountain-background"></div>
    <div class="mountain-range"></div>
    <div class="mountain-range"></div>
    <div class="stars" id="stars"></div>
    <div class="particles" id="particles"></div>
    
    <div class="splash-container" id="splash-container">
        <div class="floating-image">
            <img src="https://i.ibb.co/p6zkdWdb/1000210170.png" alt="TVision Max">
        </div>
        <h1>TVision Max</h1>
        <div class="tagline">Donde cada detalle cobra vida</div>
        <div class="description">
            Experimenta la televisi√≥n como nunca antes.
        </div>
        
        <div class="features">
            <h3>‚ú® Caracter√≠sticas principales:</h3>
            <ul>
                <li>Calidad Max: Im√°genes n√≠tidas y colores vibrantes</li>
                <li>Interfaz intuitiva: Navegaci√≥n f√°cil y fluida</li>
                <li>Contenido ilimitado: Todo tu entretenimiento en un solo lugar</li>
                <li>Streaming sin interrupciones: Disfruta sin l√≠mites</li>
            </ul>
        </div>
        
        <div class="final-message">
            La evoluci√≥n de la televisi√≥n est√° aqu√≠.
        </div>
        <div class="slogan">
            TVision Max - M√°xima calidad, m√°xima experiencia.
        </div>
        
        <div class="loading-bar">
            <div class="loading-progress" id="loading-progress"></div>
        </div>
        <div class="loading-text" id="loading-text">Inicializando TVision Max...</div>
    </div>

    <!-- ===== CONTENEDOR DE LA APLICACI√ìN (OCULTO INICIALMENTE) ===== -->
    <div id="app-container">
        <!-- <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visi√≥nM√°x - Reproductor IPTV Premium</title>
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <style>
        :root {
            /* PALETA DE COLORES AMOLED OPTIMIZADA */
            --primary-bg: #000000;           /* Negro puro AMOLED */
            --secondary-bg: #0A0A0A;         /* Negro casi puro */
            --accent-color: #00FF88;         /* Verde ne√≥n vibrante */
            --accent-secondary: #FF2A6D;     /* Rosa ne√≥n para contraste */
            --accent-tertiary: #00D9FF;      /* Azul ne√≥n para detalles */
            --text-color: #FFFFFF;           /* Texto blanco puro */
            --text-secondary: #AAAAAA;       /* Texto secundario */
            --card-bg: #111111;              /* Fondo de tarjetas */
            --card-hover: #1A1A1A;           /* Hover de tarjetas */
            --highlight: #FF2A6D;            /* Destacados */
            --progress-bg: #222222;          /* Fondo de barras de progreso */
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-color);
            overflow-x: hidden;
            line-height: 1.5;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            overflow: hidden;
        }
        
        /* Header con gradiente ne√≥n */
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: var(--secondary-bg);
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
            flex-shrink: 0;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-container img {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: 2px solid transparent;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary)) padding-box,
                        linear-gradient(135deg, var(--accent-color), var(--accent-secondary)) border-box;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }
        
        .logo-container h1 {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-secondary), var(--accent-tertiary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            letter-spacing: 0.5px;
        }
        
        .settings-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .settings-btn:hover {
            transform: scale(1.1);
            color: var(--accent-color);
        }
        
        /* Player View */
        #player-view {
            display: none;
            flex-direction: column;
            height: 100vh;
            background: var(--primary-bg);
            overflow: hidden;
        }
        
        /* Reproductor Inteligente Mejorado con Plyr */
        #player-wrapper {
            width: 100%;
            background-color: #000;
            position: relative;
            flex-shrink: 0;
        }
        
        #channel-player {
            width: 100%;
            height: auto;
            background: black;
            display: block;
            object-fit: contain;
        }
        
        /* Ajustes para Plyr con tema AMOLED */
        .plyr {
            --plyr-color-main: var(--accent-color);
            --plyr-control-icon-size: 18px;
            --plyr-control-spacing: 10px;
            --plyr-control-radius: 8px;
            --plyr-video-controls-background: linear-gradient(transparent, rgba(0,0,0,0.9));
            --plyr-video-control-color: white;
            --plyr-audio-controls-background: var(--secondary-bg);
            --plyr-audio-control-color: var(--text-color);
            border-radius: 0;
        }
        
        .plyr__controls {
            background: linear-gradient(transparent, rgba(0,0,0,0.9)) !important;
        }
        
        .plyr__control--overlaid {
            background: var(--accent-color) !important;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.7);
        }
        
        .plyr__control:hover {
            background: var(--accent-color) !important;
        }
        
        .plyr__progress__buffer {
            background: rgba(255,255,255,0.1) !important;
        }
        
        /* Indicadores de estado inteligente */
        .player-status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            z-index: 50;
            border: 1px solid rgba(0, 255, 136, 0.3);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }
        
        .player-status.show {
            display: flex;
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* NOTIFICACI√ìN DE SIGUIENTE EPISODIO */
        .next-episode-notification {
            position: absolute;
            bottom: 80px;
            right: 15px;
            background: rgba(10,10,10,0.95);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--accent-color);
            display: none;
            flex-direction: column;
            gap: 10px;
            max-width: 300px;
            z-index: 60;
            font-size: 0.9em;
            box-shadow: 0 5px 25px rgba(0,0,0,0.7);
            border: 1px solid rgba(0, 255, 136, 0.2);
        }
        
        .next-episode-notification.show {
            display: flex;
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .next-episode-info {
            font-size: 14px;
            color: white;
        }
        
        .next-episode-actions {
            display: flex;
            gap: 10px;
        }
        
        .notification-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            flex: 1;
            transition: all 0.2s;
            font-weight: 600;
        }
        
        .play-next-btn {
            background: var(--accent-color);
            color: #000;
        }
        
        .play-next-btn:hover {
            background: #00e077;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }
        
        .cancel-next-btn {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .cancel-next-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Search Bar in Player View */
        #player-search-bar {
            padding: 12px 15px;
            background-color: var(--secondary-bg);
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }
        
        #player-search-input {
            flex: 1;
            padding: 10px 12px;
            border: none;
            border-radius: 8px;
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        #player-search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }
        
        #back-to-main {
            background-color: var(--highlight);
            border: none;
            border-radius: 8px;
            color: var(--text-color);
            padding: 10px 15px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        #back-to-main:hover {
            background: #ff1a5e;
            transform: translateY(-2px);
        }
        
        #global-search-btn {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            color: #000;
            padding: 10px 15px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        #global-search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }
        
        /* Series Controls */
        #series-controls {
            background: var(--secondary-bg);
            padding: 15px;
            display: none;
            flex-direction: column;
            gap: 15px;
            flex-shrink: 0;
            max-height: 35vh;
            overflow-y: auto;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
        }
        
        .series-info-display {
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-secondary), var(--accent-tertiary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 136, 0.3);
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }
        
        .auto-play-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .auto-play-toggle {
            transform: scale(1.2);
            accent-color: var(--accent-color);
        }
        
        .auto-play-label {
            color: var(--text-color);
            font-size: 14px;
            font-weight: 600;
        }
        
        /* Temporadas Container */
        .seasons-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .seasons-title {
            font-size: 14px;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }
        
        .seasons-scroll {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            padding: 8px 0;
            scrollbar-width: thin;
        }
        
        .seasons-scroll::-webkit-scrollbar {
            height: 4px;
        }
        
        .seasons-scroll::-webkit-scrollbar-thumb {
            background-color: var(--accent-color);
            border-radius: 4px;
        }
        
        .season-btn {
            background: var(--card-bg);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 10px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            min-width: 110px;
            flex-shrink: 0;
            white-space: nowrap;
            color: var(--text-color);
            font-weight: 600;
        }
        
        .season-btn:hover {
            background: var(--card-hover);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .season-btn.active {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            color: #000;
            border-color: transparent;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }
        
        /* Episodios Container */
        .episodes-container {
            display: none;
            flex-direction: column;
            gap: 10px;
        }
        
        .episodes-title {
            font-size: 14px;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }
        
        .episodes-scroll {
            display: flex;
            overflow-x: auto;
            gap: 6px;
            padding: 8px 0;
            scrollbar-width: thin;
        }
        
        .episodes-scroll::-webkit-scrollbar {
            height: 4px;
        }
        
        .episodes-scroll::-webkit-scrollbar-thumb {
            background-color: var(--accent-color);
            border-radius: 4px;
        }
        
        .episode-item {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 8px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            min-width: 50px;
            flex-shrink: 0;
            white-space: nowrap;
            border: 2px solid transparent;
            color: var(--text-color);
            font-weight: 600;
        }
        
        .episode-item:hover {
            background: var(--card-hover);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .episode-item.current {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            color: #000;
            border-color: transparent;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }
        
        /* Otras Series Container */
        .other-series-container {
            display: none;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .other-series-title {
            font-size: 14px;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }
        
        .other-series-scroll {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 8px 0;
            scrollbar-width: thin;
        }
        
        .other-series-scroll::-webkit-scrollbar {
            height: 4px;
        }
        
        .other-series-scroll::-webkit-scrollbar-thumb {
            background-color: var(--accent-color);
            border-radius: 4px;
        }
        
        .other-series-item {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
            flex-shrink: 0;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .other-series-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 255, 136, 0.3);
            border-color: var(--accent-color);
        }
        
        .other-series-name {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-color);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 2.6em;
            line-height: 1.3;
        }
        
        .other-series-info {
            font-size: 11px;
            color: var(--accent-color);
        }

        /* Channels in Player View */
        #player-channels-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: var(--primary-bg);
            min-height: 300px;
            max-height: 40vh;
        }
        
        /* Main Content */
        #main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            width: 100%;
        }
        
        /* Categories Panel */
        #categories-panel {
            width: 30%;
            background-color: var(--secondary-bg);
            overflow-y: auto;
            border-right: 1px solid rgba(0, 255, 136, 0.2);
            flex-shrink: 0;
        }
        
        .category-item {
            padding: 15px 18px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .category-item:hover {
            background-color: rgba(0, 255, 136, 0.1);
            padding-left: 22px;
        }
        
        .category-item.active {
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.15), transparent);
            color: var(--text-color);
            border-left: 3px solid var(--accent-color);
            padding-left: 22px;
        }
        
        .category-name {
            flex: 1;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            font-size: 14px;
            font-weight: 500;
        }
        
        .category-count {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            color: #000;
            border-radius: 12px;
            padding: 3px 10px;
            font-size: 12px;
            min-width: 28px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* Channels Panel */
        #channels-panel {
            width: 70%;
            background-color: var(--primary-bg);
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        /* Search Bar in Main View */
        #search-bar {
            padding: 15px;
            background-color: var(--secondary-bg);
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            flex-shrink: 0;
        }
        
        #search-input {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        #search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }
        
        /* Canales normales - 3 columnas compactas */
        .channels-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            padding: 0;
        }
        
        .channel-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 110px;
            border: 1px solid rgba(0, 255, 136, 0.3);
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
        }
        
        .channel-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
            border-color: var(--accent-color);
        }
        
        /* Estilo para canal activo/reproduci√©ndose */
        .channel-card.active {
            background: var(--card-bg);
            border: 2px solid var(--accent-color);
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }

        .channel-card.active .channel-name {
            color: var(--text-color);
            font-weight: bold;
        }

        .channel-card.active .favorite-star {
            color: var(--text-color);
        }

        /* Para canales especiales activos */
        .special-channel-card.active {
            background: var(--card-bg);
            border: 2px solid var(--accent-color);
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }

        .special-channel-card.active .special-channel-name {
            color: var(--text-color);
            font-weight: bold;
        }

        /* Indicador de reproducci√≥n en tiempo real */
        .playing-indicator {
            position: absolute;
            top: 8px;
            left: 8px;
            width: 10px;
            height: 10px;
            background: #ff4444;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            z-index: 4;
            box-shadow: 0 0 10px #ff4444;
        }

        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(0.8); opacity: 1; }
        }
        
        .channel-card img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            margin-bottom: 8px;
            flex-shrink: 0;
            object-fit: container;
        }
        
        .channel-name {
            font-size: 8px;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            text-align: center;
            line-height: 1.3;
            font-weight: 500;
        }
        
        /* Canales especiales (pel√≠culas, series, dramas) - 3 columnas con imagen completa */
        .special-channels-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            width: 100%;
            padding: 0;
        }
        
        .special-channel-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
            aspect-ratio: 2/3;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .special-channel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 255, 136, 0.3);
            border-color: var(--accent-color);
        }
        
        .special-channel-card img {
            width: 100%;
            height: 85%;
            object-fit: container;
            flex-shrink: 0;
        }
        
        .special-channel-name {
            height: 15%;
            padding: 10px 6px;
            font-size: 8px;
            color: var(--text-color);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(17, 17, 17, 0.9);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.3;
            font-weight: 500;
        }
        
        .favorite-star {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 18px;
            color: gold;
            cursor: pointer;
            z-index: 10;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            width: 26px;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .favorite-star:hover {
            transform: scale(1.2);
        }
        
        .favorite-star.inactive {
            color: #555;
        }
        
        /* Series Info */
        .series-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 5px;
            font-size: 11px;
            color: white;
            display: none;
        }
        
        .channel-card:hover .series-info {
            display: block;
        }
        
        .series-progress {
            height: 3px;
            background: #333;
            margin-top: 3px;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .series-progress-bar {
            height: 100%;
            background: var(--accent-color);
            border-radius: 2px;
            width: 0%;
        }
        
        /* Settings Menu */
        #settings-menu {
            position: absolute;
            top: 70px;
            right: 15px;
            background-color: var(--secondary-bg);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 10px;
            padding: 10px 0;
            display: none;
            z-index: 200;
            min-width: 220px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
        }
        
        .settings-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .settings-item:last-child {
            border-bottom: none;
        }
        
        .settings-item:hover {
            background-color: rgba(0, 255, 136, 0.1);
            padding-left: 20px;
        }
        
        /* Modal de b√∫squeda global */
        .search-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: flex-start;
            padding-top: 30px;
        }
        
        .search-modal-content {
            background-color: var(--secondary-bg);
            width: 90%;
            max-width: 650px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        .search-modal-header {
            padding: 18px 20px;
            background-color: var(--primary-bg);
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-modal-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .search-modal-close {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 22px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .search-modal-close:hover {
            color: var(--accent-color);
            transform: scale(1.1);
        }
        
        .search-modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .search-modal-input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .search-modal-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }
        
        .search-results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .search-result-item {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .search-result-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
            border-color: var(--accent-color);
        }
        
        .search-result-name {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--text-color);
        }
        
        .search-result-category {
            font-size: 13px;
            color: var(--accent-color);
        }
        
        /* Indicador de carga inteligente */
        .smart-loading-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: transparent;
            z-index: 10000;
            display: none;
        }
        
        .smart-loading-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-secondary));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .cache-status {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            color: var(--accent-color);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            z-index: 1000;
            display: none;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        /* ESTILOS PARA PANTALLA COMPLETA HORIZONTAL */
        .plyr--fullscreen {
            background: #000 !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
        }

        .plyr--fullscreen .plyr__video-wrapper {
            width: 100% !important;
            height: 100% !important;
        }

        .plyr--fullscreen video {
            object-fit: contain !important;
            width: 100% !important;
            height: 100% !important;
        }

        /* Ocultar elementos en pantalla completa */
        .plyr--fullscreen #player-search-bar,
        .plyr--fullscreen #series-controls,
        .plyr--fullscreen #player-channels-container,
        .plyr--fullscreen #header {
            display: none !important;
        }

        /* Para m√≥viles en landscape */
        @media (max-width: 768px) and (orientation: landscape) {
            .plyr--fullscreen {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            #main-content {
                flex-direction: column;
            }
            
            #categories-panel {
                width: 100%;
                max-height: 30vh;
            }
            
            #channels-panel {
                width: 100%;
            }
            
            .channels-grid,
            .special-channels-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .channel-card {
                height: 100px;
                padding: 10px;
            }
            
            .channel-card img {
                width: 35px;
                height: 35px;
                margin-bottom: 6px;
            }
            
            .channel-name {
                font-size: 9px;
            }
            
            .special-channel-name {
                font-size: 9px;
                padding: 8px 5px;
            }
            
            .category-name {
                font-size: 14px;
            }
            
            .season-btn {
                min-width: 100px;
                padding: 8px 12px;
            }
            
            .episode-item {
                min-width: 45px;
                padding: 7px 10px;
                font-size: 11px;
            }
            
            .other-series-item {
                min-width: 120px;
                padding: 10px;
            }
            
            .other-series-name {
                font-size: 12px;
            }
            
            .search-results-grid {
                grid-template-columns: 1fr;
            }
            
            #player-search-bar {
                flex-wrap: wrap;
            }
            
            #player-search-input {
                min-width: 150px;
            }
            
            /* Ajustes para m√°s espacio en m√≥vil */
            #player-channels-container {
                padding: 12px;
                min-height: 280px;
            }
        }
        
        @media (max-width: 480px) {
            .channels-grid,
            .special-channels-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
            
            .channel-card {
                height: 95px;
                padding: 8px;
            }
            
            .channel-card img {
                width: 30px;
                height: 30px;
                margin-bottom: 5px;
            }
            
            .channel-name {
                font-size: 10px;
            }
            
            .special-channel-name {
                font-size: 10px;
                padding: 6px 4px;
            }
            
            .category-name {
                font-size: 13px;
            }
            
            .season-btn {
                min-width: 90px;
                padding: 7px 10px;
                font-size: 12px;
            }
            
            .episode-item {
                min-width: 40px;
                padding: 6px 8px;
                font-size: 10px;
            }
            
            .other-series-item {
                min-width: 110px;
                padding: 8px;
            }
            
            .other-series-name {
                font-size: 11px;
            }
            
            #player-search-bar {
                padding: 10px 12px;
            }
            
            #player-search-input {
                font-size: 13px;
                padding: 8px;
            }
            
            #back-to-main, #global-search-btn {
                font-size: 13px;
                padding: 8px 12px;
            }
            
            /* Ajustes para m√°s espacio en m√≥vil peque√±o */
            #player-channels-container {
                padding: 10px;
                min-height: 260px;
            }
        }

        /* VERSI√ìN ESPEC√çFICA - Solo tocar lo necesario */
        #player-channels-container {
            flex: 1 !important;
            max-height: none !important;
            min-height: auto;
        }

        #channel-player {
            width: 100%;
            height: 100%;
            object-fit: fill;
        }
#player-search-bar {
    padding: 12px 15px;
    background-color: var(--secondary-bg);
    border-bottom: 1px solid rgba(0, 255, 136, 0.2);
    display: flex;
    gap: 10px;
    flex-shrink: 0;
    align-items: center; /* A√±ade esta l√≠nea */
    flex-wrap: nowrap; /* A√±ade esta l√≠nea */
}

        /* Asegurar que ocupe espacio */
        #player-view {
            display: none;
            flex-direction: column;
            height: 100vh;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- Plyr JS -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
</head>
<body>
    <!-- Indicador de carga inteligente -->
    <div class="smart-loading-indicator" id="smart-loading-indicator">
        <div class="smart-loading-bar" id="smart-loading-bar"></div>
    </div>
    
    <!-- Estado del cache -->
    <div class="cache-status" id="cache-status"></div>
    
    <div class="app-container">
        <!-- Header -->
        <div id="header">
            <div class="logo-container">
                <img src="https://i.ibb.co/p6zkdWdb/1000210170.png" alt="Death Star">
                <h1> ùëªùëΩùíäùíîùíäùíêùíè ùë¥ùíÇùíô </h1>
            </div>
            <button class="settings-btn" id="settings-btn">‚öôÔ∏è</button>
            <div id="settings-menu">
                <div class="settings-item" id="show-favorites">‚≠ê Ver Favoritos</div>
                <div class="settings-item" id="refresh-list">üîÑ Actualizar Lista</div>
                <div class="settings-item" id="load-m3u">üìÅ Cargar archivo M3U</div>
                <div class="settings-item" id="clear-cache">üóëÔ∏è Limpiar Cache</div>
                <div class="settings-item" id="close-settings">‚ùå Cerrar</div>
            </div>
        </div>

        <!-- Player View (se muestra cuando se reproduce un canal) -->
        <div id="player-view">
            <!-- Player Wrapper - MEJORADO CON PLYR -->
            <div id="player-wrapper">
                <video id="channel-player" autoplay playsinline></video>
                
                <!-- Indicador de estado -->
                <div class="player-status" id="player-status">
                    <div class="loading-spinner"></div>
                    <span id="status-text">Cargando...</span>
                </div>
                
                <!-- Notificaci√≥n de siguiente episodio - MODIFICADA -->
                <div class="next-episode-notification" id="next-episode-notification">
                    <div class="next-episode-info" id="next-episode-info">
                        Siguiente episodio en 10 segundos
                    </div>
                    <div class="next-episode-actions">
                        <button class="notification-btn play-next-btn" id="play-next-now">Reproducir ahora</button>
                        <button class="notification-btn cancel-next-btn" id="cancel-next">Cancelar</button>
                    </div>
                </div>
            </div>
            
            <!-- Search Bar in Player View -->
            <div id="player-search-bar">
                <input type="text" id="player-search-input" placeholder="Buscar en esta categor√≠a...">
                <button id="back-to-main">‚Üê Volver</button>
                <button id="global-search-btn">üîç Global</button>
            </div>
            
            <!-- Series Controls -->
            <div id="series-controls">
                <div id="series-info-display" class="series-info-display">Ojo de Halc√≥n S01 E01</div>
                <div class="auto-play-controls">
                    <input type="checkbox" id="auto-play-toggle" class="auto-play-toggle" checked>
                    <label for="auto-play-toggle" class="auto-play-label">Reproducci√≥n autom√°tica inteligente</label>
                </div>
                
                <!-- Temporadas -->
                <div id="seasons-container" class="seasons-container" style="display:none;">
                    <div class="seasons-title">üì∫ Temporadas Disponibles</div>
                    <div id="seasons-scroll" class="seasons-scroll">
                        <!-- Las temporadas se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </div>
                
                <!-- Episodios -->
                <div id="episodes-container" class="episodes-container" style="display:none;">
                    <div class="episodes-title">üé¨ Episodios de la Temporada</div>
                    <div id="episodes-scroll" class="episodes-scroll">
                        <!-- Los episodios se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </div>
                
                <!-- Otras Series -->
                <div id="other-series-container" class="other-series-container" style="display:none;">
                    <div class="other-series-title">üåü Series que te pueden gustar</div>
                    <div id="other-series-scroll" class="other-series-scroll">
                        <!-- Otras series se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </div>
            </div>
            
            <!-- Channels in Player View - MEJORADO CON M√ÅS ESPACIO -->
            <div id="player-channels-container">
                <div class="channels-grid" id="player-channels-grid">
                    <!-- Los canales de la categor√≠a actual se cargar√°n aqu√≠ -->
                </div>
            </div>
        </div>

        <!-- Main Content (vista principal) -->
        <div id="main-content">
            <!-- Categories Panel -->
            <div id="categories-panel">
                <!-- Categories will be loaded dynamically -->
            </div>

            <!-- Channels Panel -->
            <div id="channels-panel">
                <!-- Search Bar in Main View -->
                <div id="search-bar">
                    <input type="text" id="search-input" placeholder="Buscar canal...">
                </div>
                
                <!-- Channels Grid -->
                <div id="channels-grid-container">
                    <!-- Channels will be loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de B√∫squeda Global -->
    <div id="global-search-modal" class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-header">
                <div class="search-modal-title">üîç B√∫squeda Global</div>
                <button class="search-modal-close" id="close-global-search">‚úï</button>
            </div>
            <div class="search-modal-body">
                <input type="text" id="global-search-input" class="search-modal-input" placeholder="Buscar en todos los canales, series y categor√≠as...">
                <div id="global-search-results" class="search-results-grid">
                    <!-- Los resultados de b√∫squeda se cargar√°n aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="file-input" accept=".m3u,.m3u8,.txt" style="display:none">

    <script>
        // ===== SISTEMA DE GESTI√ìN DE ARCHIVOS GRANDES SILENCIOSO =====
        const MAX_FILE_SIZE = 500 * 1024 * 1024; // 500 MB m√°ximo
        const MAX_URL_SIZE = 100 * 1024 * 1024; // 100 MB para URLs
        const BATCH_PROCESSING_SIZE = 1000; // Procesar 1000 l√≠neas por lote

        // ===== SISTEMA DE REPRODUCCI√ìN INTELIGENTE MEJORADO CON PLYR =====
        class SmartVideoPlayer {
            constructor(videoElement) {
                this.video = videoElement;
                this.hls = null;
                this.currentUrl = null;
                this.isPlaying = false;
                this.currentTime = 0;
                this.duration = 0;
                this.playbackPositions = new Map();
                this.retryCount = 0;
                this.maxRetries = 3;
                this.nextEpisodeTimer = null;
                this.autoPlayEnabled = true;
                this.nextEpisodeNotificationShown = false;
                this.plyr = null;
                
                // Elementos de UI
                this.playerStatus = document.getElementById('player-status');
                this.statusText = document.getElementById('status-text');
                this.nextEpisodeNotification = document.getElementById('next-episode-notification');
                this.nextEpisodeInfo = document.getElementById('next-episode-info');
                this.playNextNowBtn = document.getElementById('play-next-now');
                this.cancelNextBtn = document.getElementById('cancel-next');
                
                this.initializePlyr();
                this.setupEventListeners();
            }
            
            initializePlyr() {
                // Ocultar controles nativos del video
                this.video.controls = false;
                
                // Inicializar Plyr CON PANTALLA COMPLETA HORIZONTAL Y CALIDAD M√ÅXIMA
                this.plyr = new Plyr(this.video, {
                    controls: [
                        'play-large',
                        'play',
                        'progress',
                        'current-time',
                        'mute',
                        'volume',
                        'settings',
                        'fullscreen'
                    ],
                    settings: ['quality', 'speed'],
                    quality: {
                        default: 0, // Calidad m√°s alta por defecto
                        options: [0], // Forzar calidad m√°xima
                        forced: true,
                        onChange: (quality) => {
                            // Forzar siempre la calidad m√°s alta disponible
                            if (this.hls && this.hls.levels.length > 0) {
                                const maxLevel = this.hls.levels.length - 1;
                                this.hls.currentLevel = maxLevel;
                            }
                        }
                    },
                    invertTime: false,
                    tooltips: { controls: true, seek: true },
                    keyboard: { focused: true, global: true },
                    seekTime: 10,
                    volume: 0.8,
                    clickToPlay: true,
                    hideControls: true,
                    resetOnEnd: false
                });
                
                // CONFIGURACI√ìN PARA PANTALLA COMPLETA HORIZONTAL
                this.setupFullscreenOrientation();
                
                // Personalizar Plyr para que coincida con tu tema
                this.customizePlyr();
            }
            
            // NUEVA FUNCI√ìN: Configurar orientaci√≥n horizontal en pantalla completa
            setupFullscreenOrientation() {
                // Cuando entra en pantalla completa
                this.plyr.on('enterfullscreen', event => {
                    console.log('Entrando en pantalla completa - Forzando horizontal');
                    
                    // Forzar orientaci√≥n horizontal en dispositivos m√≥viles
                    this.lockHorizontalOrientation();
                    
                    // Ocultar elementos de la interfaz
                    this.hideUIElements();
                });
                
                // Cuando sale de pantalla completa
                this.plyr.on('exitfullscreen', event => {
                    console.log('Saliendo de pantalla completa');
                    
                    // Liberar el bloqueo de orientaci√≥n
                    this.unlockOrientation();
                    
                    // Mostrar elementos de la interfaz
                    this.showUIElements();
                });
            }
            
            // NUEVA FUNCI√ìN: Forzar orientaci√≥n horizontal
            lockHorizontalOrientation() {
                // Intentar usar Screen Orientation API
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('landscape').catch(error => {
                        console.log('No se pudo bloquear orientaci√≥n:', error);
                        // Fallback: usar CSS para forzar landscape
                        this.forceLandscapeWithCSS();
                    });
                } else {
                    // Fallback para navegadores que no soportan Screen Orientation API
                    this.forceLandscapeWithCSS();
                }
            }
            
            // NUEVA FUNCI√ìN: Forzar landscape con CSS
            forceLandscapeWithCSS() {
                // Agregar clase CSS para landscape
                document.documentElement.classList.add('force-landscape');
                
                // Crear estilo CSS para landscape forzado
                const landscapeStyle = document.createElement('style');
                landscapeStyle.id = 'landscape-style';
                landscapeStyle.textContent = `
                    .force-landscape body {
                        transform: rotate(90deg);
                        transform-origin: center center;
                        width: 100vh;
                        height: 100vw;
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        margin-top: -50vw;
                        margin-left: -50vh;
                        overflow: hidden;
                    }
                    .force-landscape .plyr--fullscreen {
                        transform: rotate(0deg) !important;
                    }
                `;
                document.head.appendChild(landscapeStyle);
            }
            
            // NUEVA FUNCI√ìN: Liberar orientaci√≥n
            unlockOrientation() {
                // Liberar Screen Orientation API
                if (screen.orientation && screen.orientation.unlock) {
                    screen.orientation.unlock();
                }
                
                // Remover CSS de landscape forzado
                document.documentElement.classList.remove('force-landscape');
                const landscapeStyle = document.getElementById('landscape-style');
                if (landscapeStyle) {
                    landscapeStyle.remove();
                }
            }
            
            // NUEVA FUNCI√ìN: Ocultar elementos de UI
            hideUIElements() {
                const elementsToHide = [
                    '#player-search-bar',
                    '#series-controls',
                    '#player-channels-container',
                    '#header'
                ];
                
                elementsToHide.forEach(selector => {
                    const element = document.querySelector(selector);
                    if (element) {
                        element.style.display = 'none';
                    }
                });
                
                document.body.style.overflow = 'hidden';
            }
            
            // NUEVA FUNCI√ìN: Mostrar elementos de UI
            showUIElements() {
                const elementsToShow = [
                    '#player-search-bar',
                    '#series-controls', 
                    '#player-channels-container',
                    '#header'
                ];
                
                elementsToShow.forEach(selector => {
                    const element = document.querySelector(selector);
                    if (element) {
                        element.style.display = '';
                    }
                });
                
                document.body.style.overflow = '';
            }
            
            customizePlyr() {
                // Aplicar estilos personalizados a Plyr
                const style = document.createElement('style');
                style.textContent = `
                    .plyr--full-ui input[type="range"] {
                        color: var(--accent-color);
                    }
                    .plyr__control--overlaid {
                        background: var(--accent-color);
                    }
                    .plyr__control:hover {
                        background: var(--accent-color);
                    }
                    .plyr--video .plyr__controls {
                        background: linear-gradient(transparent, rgba(0,0,0,0.8));
                    }
                `;
                document.head.appendChild(style);
            }
            
            setupEventListeners() {
                // Eventos del video
                this.video.addEventListener('loadedmetadata', () => {
                    this.duration = this.video.duration;
                    this.restorePlaybackPosition();
                });
                
                this.video.addEventListener('timeupdate', () => {
                    this.currentTime = this.video.currentTime;
                    this.checkForNextEpisode();
                    this.savePlaybackPosition();
                });
                
                this.video.addEventListener('waiting', () => {
                    this.showStatus('Buffering...');
                });
                
                this.video.addEventListener('playing', () => {
                    this.hideStatus();
                });
                
                this.video.addEventListener('ended', () => {
                    this.handleVideoEnded();
                });
                
                this.video.addEventListener('error', (e) => {
                    this.handleVideoError(e);
                });
                
                // Eventos de Plyr
                this.plyr.on('ready', () => {
                    console.log('Plyr est√° listo - Pantalla completa horizontal habilitada');
                });
                
                // Eventos de siguiente episodio
                this.playNextNowBtn.addEventListener('click', () => {
                    this.playNextEpisode();
                });
                
                this.cancelNextBtn.addEventListener('click', () => {
                    this.cancelNextEpisode();
                });
                
                // NUEVO: Detectar cambios de orientaci√≥n
                window.addEventListener('orientationchange', () => {
                    this.handleOrientationChange();
                });
            }
            
            // NUEVA FUNCI√ìN: Manejar cambios de orientaci√≥n
            handleOrientationChange() {
                if (this.plyr.fullscreen.active) {
                    // Si est√° en pantalla completa y cambia la orientaci√≥n, ajustar
                    setTimeout(() => {
                        if (window.orientation === 90 || window.orientation === -90) {
                            console.log('En landscape - pantalla completa activa');
                        } else {
                            console.log('En portrait - forzar landscape');
                            this.lockHorizontalOrientation();
                        }
                    }, 100);
                }
            }
            
            // AGREGAR ESTA FUNCI√ìN NUEVA PARA MANEJAR CALIDAD
            forceHighestQuality() {
                if (this.hls && this.hls.levels && this.hls.levels.length > 0) {
                    const levels = this.hls.levels;
                    let maxBitrate = 0;
                    let maxLevelIndex = -1;
                    
                    // Encontrar el nivel con el bitrate m√°s alto
                    for (let i = 0; i < levels.length; i++) {
                        if (levels[i].bitrate > maxBitrate) {
                            maxBitrate = levels[i].bitrate;
                            maxLevelIndex = i;
                        }
                    }
                    
                    if (maxLevelIndex !== -1) {
                        this.hls.currentLevel = maxLevelIndex;
                        console.log(`Forzando calidad m√°xima: Nivel ${maxLevelIndex} (${Math.round(maxBitrate/1000)} kbps)`);
                    }
                }
            }
            
            // Reproducir URL con sistema inteligente mejorado
            play(url, channelInfo = null) {
                this.currentUrl = url;
                this.currentChannel = channelInfo;
                
                // Limpiar reproducci√≥n anterior
                this.stop();
                
                // Mostrar estado de carga
                this.showStatus('Cargando...');
                
                // Aplicar transformaci√≥n de URL
                const finalUrl = transformUrlToM3u8(url);
                console.log('Reproduciendo URL inteligente:', finalUrl);
                
                const isHlsStream = finalUrl.toLowerCase().endsWith('.m3u8');
                
                if (isHlsStream) {
                    this.playHlsStream(finalUrl);
                } else {
                    this.playDirectStream(finalUrl);
                }
            }
            
            playHlsStream(url) {
                if (Hls.isSupported()) {
                    this.hls = new Hls({
                        enableWorker: true,
                        lowLatencyMode: true,
                        backBufferLength: 90,
                        // CONFIGURACI√ìN PARA M√ÅXIMA CALIDAD
                        startLevel: -1, // Auto selecciona la mejor calidad disponible
                        maxMaxBufferLength: 600, // Buffer m√°s grande para alta calidad
                        maxBufferSize: 120 * 1000 * 1000, // 120MB para streams de alta calidad
                        maxBufferHole: 0.5,
                        highBufferWatchdogPeriod: 2,
                        nudgeOffset: 0.1,
                        nudgeMaxRetry: 3,
                        maxFragLookUpTolerance: 0.2,
                        liveSyncDurationCount: 3,
                        liveMaxLatencyDurationCount: 10,
                        liveDurationInfinity: false,
                        liveBackBufferLength: 0,
                        maxLiveSyncPlaybackRate: 1.1,
                        // FORZAR CALIDAD M√ÅXIMA
                        abrEwmaDefaultEstimate: 5000000, // 5 Mbps como estimaci√≥n inicial
                        abrEwmaSlowLive: 3.0,
                        abrEwmaFastLive: 1.0,
                        abrEwmaDefaultLive: 3.0,
                        abrEwmaSlowVoD: 3.0,
                        abrEwmaFastVoD: 1.0,
                        abrEwmaDefaultVoD: 3.0,
                        abrMaxWithRealBitrate: true,
                        maxStarvationDelay: 4,
                        maxLoadingDelay: 4,
                        minAutoBitrate: 0,
                        emeEnabled: true,
                        widevineLicenseUrl: ''
                    });
                    
                    this.hls.loadSource(url);
                    this.hls.attachMedia(this.video);
                    
                    // NUEVO: CONFIGURACI√ìN PARA CALIDAD M√ÅXIMA
                    this.hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        // Seleccionar autom√°ticamente la calidad m√°s alta disponible
                        const levels = this.hls.levels;
                        if (levels && levels.length > 0) {
                            // Encontrar el nivel con el bitrate m√°s alto
                            let maxBitrate = 0;
                            let maxLevel = 0;
                            
                            levels.forEach((level, index) => {
                                if (level.bitrate > maxBitrate) {
                                    maxBitrate = level.bitrate;
                                    maxLevel = index;
                                }
                            });
                            
                            // Forzar la calidad m√°s alta
                            this.hls.nextLevel = maxLevel;
                            this.hls.currentLevel = maxLevel;
                            
                            console.log(`Calidad seleccionada: ${maxLevel} (${Math.round(maxBitrate/1000)} kbps)`);
                        }
                        
                        this.hideStatus();
                        this.video.play().catch(e => {
                            console.error('Error al reproducir:', e);
                            this.showStatus('Error de reproducci√≥n');
                        });
                    });
                    
                    this.hls.on(Hls.Events.MANIFEST_LOADED, () => {
                        console.log('Manifest cargado, forzando calidad m√°xima...');
                        setTimeout(() => {
                            this.forceHighestQuality();
                        }, 1000);
                    });
                    
                    this.hls.on(Hls.Events.ERROR, (event, data) => {
                        console.error('Error HLS:', data);
                        this.handleHlsError(data);
                    });
                    
                    this.hls.on(Hls.Events.BUFFER_APPENDED, () => {
                        this.hideStatus();
                    });
                    
                } else if (this.video.canPlayType('application/vnd.apple.mpegurl')) {
                    // Soporte nativo para HLS (Safari)
                    this.video.src = url;
                    this.video.play().catch(e => {
                        console.error('Error al reproducir:', e);
                        this.showStatus('Error de reproducci√≥n');
                    });
                } else {
                    this.showStatus('Formato no soportado');
                }
            }
            
            playDirectStream(url) {
                this.video.src = url;
                this.video.play().catch(e => {
                    console.error('Error al reproducir:', e);
                    this.showStatus('Error de reproducci√≥n');
                });
            }
            
            // Manejo inteligente de errores
            handleHlsError(data) {
                if (data.fatal) {
                    switch (data.type) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            this.showStatus('Error de red, reintentando...');
                            this.retryPlayback();
                            break;
                        case Hls.ErrorTypes.MEDIA_ERROR:
                            this.showStatus('Error de medio, recuperando...');
                            this.hls.recoverMediaError();
                            break;
                        default:
                            this.showStatus('Error fatal');
                            this.hls.destroy();
                            break;
                    }
                }
            }
            
            handleVideoError(e) {
                console.error('Error de video:', e);
                this.showStatus('Error de reproducci√≥n');
                this.retryPlayback();
            }
            
            retryPlayback() {
                if (this.retryCount < this.maxRetries) {
                    this.retryCount++;
                    this.showStatus(`Reintentando... (${this.retryCount}/${this.maxRetries})`);
                    
                    setTimeout(() => {
                        if (this.currentUrl) {
                            this.play(this.currentUrl, this.currentChannel);
                        }
                    }, 2000 * this.retryCount);
                } else {
                    this.showStatus('Error: No se puede reproducir');
                }
            }
            
            // Gesti√≥n de posici√≥n de reproducci√≥n
            savePlaybackPosition() {
                if (this.currentUrl && this.video.duration > 0) {
                    const position = this.video.currentTime;
                    const percent = (position / this.video.duration) * 100;
                    
                    // Solo guardar si ha visto al menos 10 segundos y no est√° cerca del final
                    if (position > 10 && percent < 95) {
                        this.playbackPositions.set(this.currentUrl, {
                            time: position,
                            timestamp: Date.now()
                        });
                        
                        // Actualizar progreso en la serie si es aplicable
                        if (this.currentChannel && this.currentChannel.seriesInfo) {
                            updateSeriesProgress(
                                this.currentChannel.seriesInfo.seriesName,
                                this.currentChannel.seriesInfo.season,
                                this.currentChannel.seriesInfo.episode,
                                percent / 100
                            );
                        }
                    }
                }
            }
            
            restorePlaybackPosition() {
                if (this.currentUrl && this.playbackPositions.has(this.currentUrl)) {
                    const saved = this.playbackPositions.get(this.currentUrl);
                    const currentTime = Date.now();
                    const timeDiff = currentTime - saved.timestamp;
                    
                    // Restaurar posici√≥n si fue guardada en las √∫ltimas 24 horas
                    if (timeDiff < 24 * 60 * 60 * 1000) {
                        this.video.currentTime = saved.time;
                        console.log(`Posici√≥n restaurada: ${Math.round(saved.time)}s`);
                    }
                }
            }
            
            // ===== SISTEMA DE SIGUIENTE EPISODIO AUTOM√ÅTICO - MODIFICADO =====
            checkForNextEpisode() {
                if (!this.currentChannel || !this.currentChannel.seriesInfo) return;
                
                const timeLeft = this.video.duration - this.video.currentTime;
                
                // Reproducir autom√°ticamente sin mostrar mensaje (m√°s profesional)
                if (timeLeft <= 5 && this.autoPlayEnabled && !this.nextEpisodeTimer) {
                    this.playNextEpisode();
                }
            }
            
            playNextEpisode() {
                const nextEpisode = findNextEpisode(this.currentChannel);
                if (nextEpisode) {
                    this.cancelNextEpisode();
                    playSeries(nextEpisode);
                }
            }
            
            cancelNextEpisode() {
                if (this.nextEpisodeTimer) {
                    clearTimeout(this.nextEpisodeTimer);
                    this.nextEpisodeTimer = null;
                }
                this.nextEpisodeNotification.classList.remove('show');
                this.nextEpisodeNotificationShown = false;
            }
            
            handleVideoEnded() {
                if (this.autoPlayEnabled) {
                    this.playNextEpisode();
                }
            }
            
            showStatus(message) {
                this.statusText.textContent = message;
                this.playerStatus.classList.add('show');
            }
            
            hideStatus() {
                this.playerStatus.classList.remove('show');
                this.retryCount = 0;
            }
            
            // Detener reproducci√≥n
            stop() {
                this.cancelNextEpisode();
                
                if (this.hls) {
                    this.hls.destroy();
                    this.hls = null;
                }
                
                this.video.pause();
                this.video.removeAttribute('src');
                this.video.load();
                
                this.hideStatus();
            }
            
            // Configurar autoplay
            setAutoPlay(enabled) {
                this.autoPlayEnabled = enabled;
            }
        }

        // ===== SISTEMA DE CACHE INTELIGENTE =====
        class SmartCacheManager {
            constructor() {
                this.cacheVersion = 'v2.0';
                this.cacheKey = 'iptv_smart_cache';
                this.lastUpdateKey = 'iptv_last_update';
                this.cacheExpiry = 24 * 60 * 60 * 1000; // 24 horas
                this.isUpdating = false;
            }
            
            // Verificar si hay datos en cache y si est√°n actualizados
            hasValidCache() {
                try {
                    const cachedData = localStorage.getItem(this.cacheKey);
                    const lastUpdate = localStorage.getItem(this.lastUpdateKey);
                    
                    if (!cachedData || !lastUpdate) {
                        return false;
                    }
                    
                    const timeSinceUpdate = Date.now() - parseInt(lastUpdate);
                    return timeSinceUpdate < this.cacheExpiry;
                } catch (e) {
                    console.error('Error verificando cache:', e);
                    return false;
                }
            }
            
            // Cargar datos desde cache
            loadFromCache() {
                try {
                    const cachedData = localStorage.getItem(this.cacheKey);
                    if (cachedData) {
                        return JSON.parse(cachedData);
                    }
                } catch (e) {
                    console.error('Error cargando desde cache:', e);
                }
                return null;
            }
            
            // Guardar datos en cache
            saveToCache(data) {
                try {
                    localStorage.setItem(this.cacheKey, JSON.stringify(data));
                    localStorage.setItem(this.lastUpdateKey, Date.now().toString());
                    return true;
                } catch (e) {
                    console.error('Error guardando en cache:', e);
                    return false;
                }
            }
            
            // Limpiar cache - CORREGIDO: Sin mensajes ni recargas
            clearCache() {
                try {
                    localStorage.removeItem(this.cacheKey);
                    localStorage.removeItem(this.lastUpdateKey);
                    return true;
                } catch (e) {
                    console.error('Error limpiando cache:', e);
                    return false;
                }
            }
            
            // Obtener estado del cache
            getCacheStatus() {
                const hasCache = this.hasValidCache();
                const lastUpdate = localStorage.getItem(this.lastUpdateKey);
                const lastUpdateTime = lastUpdate ? new Date(parseInt(lastUpdate)).toLocaleTimeString() : 'Nunca';
                
                return {
                    hasCache,
                    lastUpdate: lastUpdateTime,
                    isUpdating: this.isUpdating
                };
            }
        }

        // ===== SISTEMA DE CARGA INTELIGENTE =====
        class SmartLoader {
            constructor() {
                this.cacheManager = new SmartCacheManager();
                this.isInitialLoad = true;
                this.loadingIndicator = document.getElementById('smart-loading-indicator');
                this.loadingBar = document.getElementById('smart-loading-bar');
                this.cacheStatus = document.getElementById('cache-status');
            }
            
            // Cargar datos de forma inteligente
            async loadData() {
                // PRIMERO: Intentar cargar desde cache si est√° disponible
                if (this.cacheManager.hasValidCache()) {
                    const cachedData = this.cacheManager.loadFromCache();
                    
                    if (cachedData && cachedData.allChannels && cachedData.categories) {
                        // Usar datos del cache inmediatamente
                        this.applyCachedData(cachedData);
                        
                        // Actualizar en segundo plano
                        this.updateInBackground();
                        
                        return true;
                    }
                }
                
                // SEGUNDO: Si no hay cache v√°lido, cargar desde Drive
                return await this.loadFromDrive();
            }
            
            // Aplicar datos del cache
            applyCachedData(cachedData) {
                allChannels = cachedData.allChannels || [];
                categories = new Map(Object.entries(cachedData.categories || {}));
                allSeries = cachedData.allSeries || [];
                
                // Inicializar sistemas
                searchEngine = new SearchEngine(allChannels);
                
                // Renderizar inmediatamente
                renderCategories();
                renderChannels();
            }
            
            // Cargar desde Google Drive
            async loadFromDrive() {
                this.showLoadingIndicator();
                
                try {
                    const result = await loadFromGoogleDriveSilent();
                    const content = result.content;
                    
                    if (!content || !content.includes('#EXTM3U')) {
                        throw new Error('Contenido no v√°lido');
                    }
                    
                    // Parsear y procesar datos
                    parseM3U(content);
                    
                    // Guardar en cache para uso futuro
                    const cacheData = {
                        allChannels: allChannels,
                        categories: Object.fromEntries(categories),
                        allSeries: allSeries,
                        timestamp: Date.now()
                    };
                    
                    this.cacheManager.saveToCache(cacheData);
                    
                    return true;
                    
                } catch (error) {
                    console.error('Error cargando desde Drive:', error);
                    
                    // Si falla, intentar usar cache aunque est√© expirado
                    const cachedData = this.cacheManager.loadFromCache();
                    if (cachedData) {
                        this.applyCachedData(cachedData);
                        return true;
                    }
                    
                    return false;
                } finally {
                    this.hideLoadingIndicator();
                }
            }
            
            // Actualizar en segundo plano
            async updateInBackground() {
                if (this.cacheManager.isUpdating) return;
                
                this.cacheManager.isUpdating = true;
                
                try {
                    const result = await loadFromGoogleDriveSilent();
                    const content = result.content;
                    
                    if (content && content.includes('#EXTM3U')) {
                        // Parsear datos nuevos
                        const oldChannels = [...allChannels];
                        parseM3U(content);
                        
                        // Verificar si hay cambios significativos
                        if (this.hasSignificantChanges(oldChannels, allChannels)) {
                            // Guardar nuevo cache
                            const cacheData = {
                                allChannels: allChannels,
                                categories: Object.fromEntries(categories),
                                allSeries: allSeries,
                                timestamp: Date.now()
                            };
                            
                            this.cacheManager.saveToCache(cacheData);
                        }
                    }
                } catch (error) {
                    console.error('Error en actualizaci√≥n en segundo plano:', error);
                } finally {
                    this.cacheManager.isUpdating = false;
                }
            }
            
            // Verificar si hay cambios significativos
            hasSignificantChanges(oldChannels, newChannels) {
                if (oldChannels.length !== newChannels.length) return true;
                
                // Verificar si hay cambios en URLs (canales nuevos/eliminados)
                const oldUrls = new Set(oldChannels.map(c => c.url));
                const newUrls = new Set(newChannels.map(c => c.url));
                
                if (oldUrls.size !== newUrls.size) return true;
                
                for (let url of oldUrls) {
                    if (!newUrls.has(url)) return true;
                }
                
                return false;
            }
            
            // Mostrar indicador de carga
            showLoadingIndicator() {
                if (this.loadingIndicator && this.loadingBar) {
                    this.loadingIndicator.style.display = 'block';
                    this.loadingBar.style.width = '30%';
                    
                    // Simular progreso
                    setTimeout(() => {
                        if (this.loadingBar) {
                            this.loadingBar.style.width = '70%';
                        }
                    }, 500);
                }
            }
            
            // Ocultar indicador de carga
            hideLoadingIndicator() {
                if (this.loadingIndicator && this.loadingBar) {
                    this.loadingBar.style.width = '100%';
                    setTimeout(() => {
                        this.loadingIndicator.style.display = 'none';
                        this.loadingBar.style.width = '0%';
                    }, 300);
                }
            }
        }

        // ===== SISTEMA DE PARSEO M3U POR LOTES =====
        class BatchM3UParser {
            constructor() {
                this.batchSize = BATCH_PROCESSING_SIZE;
                this.currentBatch = 0;
                this.isParsing = false;
                this.totalLines = 0;
                this.processedLines = 0;
            }
            
            // Parsear M3U por lotes para evitar problemas de memoria
            parseM3UBatch(data) {
                return new Promise((resolve) => {
                    const lines = data.split(/\r?\n/);
                    this.totalLines = lines.length;
                    this.processedLines = 0;
                    
                    // Limpiar datos anteriores
                    allChannels = [];
                    categories.clear();
                    allSeries = [];
                    
                    // Procesar por lotes
                    this.processBatch(lines, 0, resolve);
                });
            }
            
            processBatch(lines, startIndex, resolve) {
                if (this.isParsing) return;
                this.isParsing = true;
                
                const endIndex = Math.min(startIndex + this.batchSize, lines.length);
                let channel = null;
                
                for (let i = startIndex; i < endIndex; i++) {
                    const line = lines[i].trim();
                    this.processedLines++;
                    
                    if (line.startsWith('#EXTINF')) {
                        const groupMatch = line.match(/group-title="([^"]+)"/i);
                        const logoMatch = line.match(/tvg-logo="([^"]+)"/i);
                        const nameMatch = line.split(',')[1] || 'Sin nombre';
                        channel = {
                            group: groupMatch ? groupMatch[1] : 'Otros',
                            logo: logoMatch ? logoMatch[1] : '',
                            name: nameMatch,
                            url: ''
                        };
                        
                        // Extract series info if applicable
                        channel.seriesInfo = extractSeriesInfo(channel);
                    } else if (line && !line.startsWith('#')) {
                        if (channel) {
                            channel.url = line;
                            allChannels.push(channel);
                            
                            if (!categories.has(channel.group)) {
                                categories.set(channel.group, []);
                            }
                            categories.get(channel.group).push(channel);
                            
                            // Si es una serie, agregar a la lista de series
                            if (channel.seriesInfo && channel.seriesInfo.isSeries) {
                                const existingSeries = allSeries.find(s => s.name === channel.seriesInfo.seriesName);
                                if (!existingSeries) {
                                    allSeries.push({
                                        name: channel.seriesInfo.seriesName,
                                        episodes: [channel],
                                        group: channel.group,
                                        totalEpisodes: 1,
                                        totalSeasons: 1
                                    });
                                } else {
                                    existingSeries.episodes.push(channel);
                                    existingSeries.totalEpisodes = existingSeries.episodes.length;
                                    // Calcular temporadas √∫nicas
                                    const uniqueSeasons = [...new Set(existingSeries.episodes.map(ep => ep.seriesInfo.season))];
                                    existingSeries.totalSeasons = uniqueSeasons.length;
                                }
                            }
                            
                            channel = null;
                        }
                    }
                }
                
                // Si hay m√°s l√≠neas, procesar siguiente lote
                if (endIndex < lines.length) {
                    setTimeout(() => {
                        this.isParsing = false;
                        this.processBatch(lines, endIndex, resolve);
                    }, 0);
                } else {
                    // Procesamiento completado
                    this.isParsing = false;
                    resolve();
                }
            }
        }

        // ===== INICIALIZACI√ìN DEL SISTEMA INTELIGENTE =====
        const smartLoader = new SmartLoader();
        const batchParser = new BatchM3UParser();

        // ===== SISTEMA MEJORADO PARA ENLACES NUM√âRICOS =====
        const urlCache = new Map();

        // üîç FUNCI√ìN PARA DETECTAR TIPO DE STREAM
        function detectStreamType(url) {
            const urlStr = url.toLowerCase();
            
            if (urlStr.includes('.m3u8')) return 'hls';
            if (urlStr.includes('.mp4')) return 'mp4';
            if (urlStr.includes('.mkv')) return 'mkv';
            if (urlStr.includes('.avi')) return 'avi';
            if (urlStr.includes('.ts')) return 'ts';
            if (urlStr.match(/\/\d+$/)) return 'numeric_id';
            
            return 'unknown';
        }

        // üîÑ FUNCI√ìN PARA GENERAR OPCIONES DE URL PARA ENLACES NUM√âRICOS
        function generateUrlOptions(baseUrl, streamId) {
            return [
                baseUrl, // Original
                `${baseUrl}.m3u8`,
                `${baseUrl}/index.m3u8`,
                `${baseUrl.replace(/\/[^\/]+$/, '')}/playlist.m3u8?id=${streamId}`,
                `${baseUrl.replace(/\/[^\/]+$/, '')}/hls/${streamId}/index.m3u8`,
                `${baseUrl.replace(/\/[^\/]+$/, '')}/live/${streamId}/index.m3u8`,
                `${baseUrl.replace(/\/[^\/]+$/, '')}/stream/${streamId}.m3u8`,
                `${baseUrl.replace(/\/[^\/]+$/, '')}/chunklist_${streamId}.m3u8`,
                `${baseUrl}?format=m3u8`,
                `${baseUrl}?type=hls`
            ];
        }

        // ‚ö° FUNCI√ìN MEJORADA PARA TRANSFORMAR URLs (CON M√öLTIPLES ESTRATEGIAS)
        // MEJORA ESTA FUNCI√ìN EXISTENTE - NO LA REEMPLACES
function transformUrlToM3u8(url) {
    if (!url || typeof url !== 'string') return url;
    
    // USAR CACHE PARA URLs YA TRANSFORMADAS
    if (urlCache.has(url)) {
        const cached = urlCache.get(url);
        return typeof cached === 'object' ? cached.main : cached;
    }
    
    try {
        const urlLower = url.toLowerCase();
        let transformedUrl = url;
        
        // ESTRATEGIA 1: Si ya es un formato compatible, no cambiar
        if (urlLower.includes('.m3u8') || urlLower.includes('.mp4') || 
            urlLower.includes('.mkv') || urlLower.includes('.avi')) {
            urlCache.set(url, transformedUrl);
            return transformedUrl;
        }
        
        // ESTRATEGIA 2: Enlaces que terminan en n√∫mero - M√öLTIPLES OPCIONES
        if (url.match(/\/\d+$/) && !urlLower.includes('.m3u8')) {
            const baseUrl = url.replace(/\/\d+$/, '');
            const streamId = url.match(/\/(\d+)$/)[1];
            
            // Probar diferentes formatos comunes para enlaces num√©ricos
            const possibleUrls = generateUrlOptions(url, streamId);
            
            // La URL original siempre es la primera opci√≥n
            transformedUrl = possibleUrls[0];
            
            // Guardar todas las opciones en cache para pruebas posteriores
            urlCache.set(url, { main: transformedUrl, alternatives: possibleUrls });
            
        } 
        // ESTRATEGIA 3: Transformaciones para otros formatos
        else if (urlLower.includes('.ts') && !urlLower.includes('.m3u8')) {
            transformedUrl = url.replace(/\.ts$/i, '.m3u8');
        } else if (urlLower.includes('/chunklist')) {
            transformedUrl = url.replace('/chunklist', '/index');
        }
        
        // NUEVA ESTRATEGIA: Detectar y adaptar para navegadores espec√≠ficos
        transformedUrl = adaptUrlForBrowsers(transformedUrl);
        
        // GUARDAR EN CACHE
        urlCache.set(url, transformedUrl);
        return transformedUrl;
        
    } catch (e) {
        return url;
    }
}

// NUEVA FUNCI√ìN: Adaptar URL para compatibilidad entre navegadores
function adaptUrlForBrowsers(url) {
    const userAgent = navigator.userAgent.toLowerCase();
    let adaptedUrl = url;
    
    // Detectar navegador
    const isFirefox = userAgent.includes('firefox');
    const isSafari = userAgent.includes('safari') && !userAgent.includes('chrome');
    const isChrome = userAgent.includes('chrome');
    const isEdge = userAgent.includes('edg');
    
    // Adaptaciones espec√≠ficas por navegador
    if (isSafari) {
        // Safari tiene mejor soporte nativo para HLS
        if (url.includes('.m3u8')) {
            // Safari puede manejar HLS directamente
            console.log('Safari: Usando HLS nativo');
        }
    } else if (isFirefox) {
        // Firefox necesita HLS.js para streams HLS
        if (url.includes('.m3u8') && !url.includes('.mp4')) {
            console.log('Firefox: Requiere HLS.js para stream HLS');
        }
    } else if (isChrome || isEdge) {
        // Chrome y Edge tienen buen soporte
        console.log('Chrome/Edge: Buen soporte para streams');
    }
    
    return adaptedUrl;
}
        // ===== SISTEMA DE B√öSQUEDA GLOBAL Y OPTIMIZADO =====
        class SearchEngine {
            constructor(channels) {
                this.channels = channels;
                this.index = this.buildIndex();
                this.debounceTimer = null;
            }
            
            // Construir √≠ndice para b√∫squeda r√°pida
            buildIndex() {
                const index = {};
                this.channels.forEach((channel, idx) => {
                    const terms = this.extractSearchTerms(channel);
                    terms.forEach(term => {
                        if (!index[term]) index[term] = [];
                        index[term].push(idx);
                    });
                });
                return index;
            }
            
            // Extraer t√©rminos de b√∫squeda de un canal
            extractSearchTerms(channel) {
                const terms = [];
                
                // Nombre del canal
                const nameTerms = channel.name.toLowerCase()
                    .split(/[^a-z0-9√°√©√≠√≥√∫√±]+/)
                    .filter(term => term.length > 2);
                terms.push(...nameTerms);
                
                // Categor√≠a
                const groupTerms = channel.group.toLowerCase()
                    .split(/[^a-z0-9√°√©√≠√≥√∫√±]+/)
                    .filter(term => term.length > 2);
                terms.push(...groupTerms);
                
                // Informaci√≥n de series
                if (channel.seriesInfo) {
                    const seriesTerms = channel.seriesInfo.seriesName.toLowerCase()
                        .split(/[^a-z0-9√°√©√≠√≥√∫√±]+/)
                        .filter(term => term.length > 2);
                    terms.push(...seriesTerms);
                }
                
                return [...new Set(terms)]; // Eliminar duplicados
            }
            
            // B√∫squeda optimizada con puntuaci√≥n
            search(query, options = {}) {
                if (!query || query.length < 2) return [];
                
                const queryTerms = query.toLowerCase()
                    .split(/[^a-z0-9√°√©√≠√≥√∫√±]+/)
                    .filter(term => term.length > 1);
                
                if (queryTerms.length === 0) return [];
                
                // Calcular puntuaci√≥n para cada canal
                const scoredResults = this.channels.map((channel, idx) => {
                    let score = 0;
                    
                    // B√∫squeda en nombre (m√°xima prioridad)
                    const nameLower = channel.name.toLowerCase();
                    if (nameLower.includes(query.toLowerCase())) {
                        score += 100;
                    }
                    
                    // B√∫squeda por t√©rminos
                    queryTerms.forEach(term => {
                        if (nameLower.includes(term)) score += 10;
                        if (channel.group.toLowerCase().includes(term)) score += 5;
                        if (channel.seriesInfo && channel.seriesInfo.seriesName.toLowerCase().includes(term)) {
                            score += 8;
                        }
                    });
                    
                    return { channel, score, idx };
                }).filter(result => result.score > 0)
                  .sort((a, b) => b.score - a.score);
                
                // Aplicar l√≠mite si se especifica
                const limit = options.limit || 100;
                return scoredResults.slice(0, limit).map(result => result.channel);
            }
            
            // B√∫squeda con debounce para mejor rendimiento
            debouncedSearch(query, callback, delay = 300) {
                clearTimeout(this.debounceTimer);
                this.debounceTimer = setTimeout(() => {
                    const results = this.search(query);
                    callback(results);
                }, delay);
            }
            
            // Actualizar √≠ndice cuando cambian los canales
            updateChannels(newChannels) {
                this.channels = newChannels;
                this.index = this.buildIndex();
            }
        }

        // ===== SISTEMA DE CARGA PROGRESIVA =====
        class ChannelRenderer {
            constructor() {
                this.batchSize = 30;
                this.currentBatch = 0;
                this.isRendering = false;
            }
            
            // Renderizar canales por lotes para mejor rendimiento
            renderChannelsBatch(channels, container, isSpecialCategory, startIndex = 0) {
                if (this.isRendering) return;
                this.isRendering = true;
                
                const endIndex = Math.min(startIndex + this.batchSize, channels.length);
                const fragment = document.createDocumentFragment();
                
                for (let i = startIndex; i < endIndex; i++) {
                    const channelElement = this.createChannelElement(channels[i], isSpecialCategory);
                    fragment.appendChild(channelElement);
                }
                
                container.appendChild(fragment);
                
                // Programar siguiente lote si hay m√°s canales
                if (endIndex < channels.length) {
                    requestAnimationFrame(() => {
                        this.isRendering = false;
                        this.renderChannelsBatch(channels, container, isSpecialCategory, endIndex);
                    });
                } else {
                    this.isRendering = false;
                }
            }
            
            // Crear elemento de canal (optimizado)
            createChannelElement(channel, isSpecialCategory) {
                let channelElement;
                
                if (isSpecialCategory) {
                    channelElement = document.createElement('div');
                    channelElement.className = 'special-channel-card';
                    
                    const isFav = favorites.includes(channel.url);
                    const favClass = isFav ? '' : 'inactive';
                    
                    channelElement.innerHTML = `
                        <div class="favorite-star ${favClass}" data-url="${channel.url}">${isFav ? '‚òÖ' : '‚òÜ'}</div>
                        <img src="${channel.logo || 'https://via.placeholder.com/300x450/0F3460/00FFAB?text=Poster'}" alt="${channel.name}" loading="lazy">
                        <div class="special-channel-name">${channel.name}</div>
                    `;
                } else {
                    channelElement = document.createElement('div');
                    channelElement.className = 'channel-card';
                    
                    const isFav = favorites.includes(channel.url);
                    const favClass = isFav ? '' : 'inactive';
                    
                    let seriesInfoHTML = '';
                    if (channel.seriesInfo && channel.seriesInfo.isSeries) {
                        const progress = getSeriesProgress(channel.seriesInfo.seriesName, channel.seriesInfo.season, channel.seriesInfo.episode);
                        const progressPercent = progress * 100;
                        
                        seriesInfoHTML = `
                            <div class="series-info">
                                <div>T${channel.seriesInfo.season} E${channel.seriesInfo.episode}</div>
                                <div class="series-progress">
                                    <div class="series-progress-bar" style="width: ${progressPercent}%"></div>
                                </div>
                            </div>
                        `;
                    }
                    
                    channelElement.innerHTML = `
                        <div class="favorite-star ${favClass}" data-url="${channel.url}">${isFav ? '‚òÖ' : '‚òÜ'}</div>
                        <img src="${channel.logo || 'https://via.placeholder.com/50x50/0F3460/00FFAB?text=TV'}" alt="${channel.name}" loading="lazy">
                        <div class="channel-name">${channel.name}</div>
                        ${seriesInfoHTML}
                    `;
                }
                
                // Marcar como activo si es el canal actualmente reproduci√©ndose
                if (channel.url === currentPlayingChannelUrl) {
                    channelElement.classList.add('active');
                    
                    // Agregar indicador de reproducci√≥n
                    const indicator = document.createElement('div');
                    indicator.className = 'playing-indicator';
                    channelElement.style.position = 'relative';
                    channelElement.appendChild(indicator);
                }
                
                // Event listeners optimizados
                this.attachChannelEventListeners(channelElement, channel);
                
                return channelElement;
            }
            
            // Adjuntar event listeners de forma eficiente
            attachChannelEventListeners(element, channel) {
                const favStar = element.querySelector('.favorite-star');
                favStar.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFavorite(channel.url);
                    renderCategories();
                    renderChannels();
                });
                
                element.addEventListener('click', () => {
                    if (channel.seriesInfo && channel.seriesInfo.isSeries) {
                        playSeries(channel);
                    } else {
                        playChannel(channel);
                    }
                });
            }
            
            // Limpiar contenedor de forma eficiente
            clearContainer(container) {
                while (container.firstChild) {
                    container.removeChild(container.firstChild);
                }
            }
            
            // Crear elemento de resultado de b√∫squeda global
            createSearchResultElement(channel) {
                const resultElement = document.createElement('div');
                resultElement.className = 'search-result-item';
                
                const isSeries = channel.seriesInfo && channel.seriesInfo.isSeries;
                const seriesInfo = isSeries ? 
                    `S${channel.seriesInfo.season} E${channel.seriesInfo.episode}` : '';
                
                resultElement.innerHTML = `
                    <div class="search-result-name">${channel.name}</div>
                    <div class="search-result-category">${channel.group} ${seriesInfo}</div>
                `;
                
                resultElement.addEventListener('click', () => {
                    // Cerrar modal
                    closeGlobalSearchModal();
                    
                    // Reproducir el canal
                    if (isSeries) {
                        playSeries(channel);
                    } else {
                        playChannel(channel);
                    }
                });
                
                return resultElement;
            }
        }

        // ===== INICIALIZACI√ìN DE SISTEMAS OPTIMIZADOS =====
        let searchEngine = null;
        let channelRenderer = new ChannelRenderer();
        let videoPlayer = null;

        // Global variables
        const playerView = document.getElementById('player-view');
        const mainContent = document.getElementById('main-content');
        const channelPlayer = document.getElementById('channel-player');
        const playerSearchInput = document.getElementById('player-search-input');
        const backToMain = document.getElementById('back-to-main');
        const globalSearchBtn = document.getElementById('global-search-btn');
        const seriesControls = document.getElementById('series-controls');
        const seriesInfoDisplay = document.getElementById('series-info-display');
        const autoPlayToggle = document.getElementById('auto-play-toggle');
        
        // Elementos para sistema de series CORREGIDO
        const seasonsContainer = document.getElementById('seasons-container');
        const seasonsScroll = document.getElementById('seasons-scroll');
        const episodesContainer = document.getElementById('episodes-container');
        const episodesScroll = document.getElementById('episodes-scroll');
        const otherSeriesContainer = document.getElementById('other-series-container');
        const otherSeriesScroll = document.getElementById('other-series-scroll');
        
        const playerChannelsGrid = document.getElementById('player-channels-grid');
        const categoriesPanel = document.getElementById('categories-panel');
        const channelsGridContainer = document.getElementById('channels-grid-container');
        const searchInput = document.getElementById('search-input');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsMenu = document.getElementById('settings-menu');
        const fileInput = document.getElementById('file-input');

        // Elementos del modal de b√∫squeda global
        const globalSearchModal = document.getElementById('global-search-modal');
        const globalSearchInput = document.getElementById('global-search-input');
        const globalSearchResults = document.getElementById('global-search-results');
        const closeGlobalSearchBtn = document.getElementById('close-global-search');

        let allChannels = [];
        let categories = new Map();
        let favorites = JSON.parse(localStorage.getItem('iptv_favorites') || '[]');
        let currentCategory = null;
        let showingFavorites = false;
        let searchActive = false;
        let seriesProgress = JSON.parse(localStorage.getItem('series_progress') || '{}');

        // Variables para manejar series
        let currentSeriesEpisodes = [];
        let currentSeason = 1;
        let currentEpisodeIndex = 0;
        let currentSeriesName = '';
        let autoPlayEnabled = true;
        let currentPlayingChannel = null;
        let currentPlayingChannelUrl = null;
        let allSeries = [];

        // ===== CONFIGURACI√ìN DE GOOGLE DRIVE OCULTA =====
        const DRIVE_FILE_ID = "157ynRfM0FMDsJBCXn_8GhBvtMXgmJ2Ou";
        const PROXIES = [
            {
                name: "CorsProxy",
                url: (id) => `https://corsproxy.io/?${encodeURIComponent(`https://drive.google.com/uc?export=download&id=${id}`)}`,
                timeout: 5000
            },
            {
                name: "AllOrigins", 
                url: (id) => `https://api.allorigins.win/raw?url=${encodeURIComponent(`https://drive.google.com/uc?export=download&id=${id}`)}`,
                timeout: 5000
            },
            {
                name: "ThingProxy",
                url: (id) => `https://thingproxy.freeboard.io/fetch/https://drive.google.com/uc?export=download&id=${id}`,
                timeout: 4000
            }
        ];

        // ===== FUNCIONES PARA CARGA DESDE GOOGLE DRIVE =====
        async function loadFromGoogleDriveSilent() {
            const promises = PROXIES.map(proxy => 
                Promise.race([
                    fetch(proxy.url(DRIVE_FILE_ID), {
                        method: 'GET',
                        headers: {
                            'Accept': 'text/plain, application/x-mpegURL',
                            'Cache-Control': 'no-cache'
                        }
                    }),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('timeout')), proxy.timeout)
                    )
                ])
                .then(async response => {
                    if (!response.ok) throw new Error('HTTP error');
                    const content = await response.text();
                    if (!content || !content.includes('#EXTM3U')) {
                        throw new Error('Invalid content');
                    }
                    return { content, proxy: proxy.name };
                })
                .catch(error => {
                    throw error;
                })
            );

            return Promise.any(promises);
        }

        // ===== NUEVO SISTEMA DE PARSEO M3U CON VERIFICACI√ìN DE TAMA√ëO SILENCIOSO =====
        function parseM3U(data) {
            // Verificar tama√±o del contenido silenciosamente
            const contentSize = new Blob([data]).size;
            
            if (contentSize > MAX_FILE_SIZE) {
                // Silenciosamente rechazar archivos demasiado grandes
                return;
            }
            
            // Usar el parser por lotes para archivos grandes silenciosamente
            if (contentSize > 5 * 1024 * 1024) { // 5 MB
                batchParser.parseM3UBatch(data).then(() => {
                    // Inicializar motor de b√∫squeda con los nuevos canales
                    searchEngine = new SearchEngine(allChannels);
                    
                    renderCategories();
                    renderChannels();
                });
            } else {
                // Parseo normal para archivos peque√±os
                parseM3UNormal(data);
            }
        }

        // Parse M3U content normal (para archivos peque√±os)
        function parseM3UNormal(data) {
            allChannels = [];
            categories.clear();
            allSeries = [];
            
            const lines = data.split(/\r?\n/);
            let channel = null;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF')) {
                    const groupMatch = line.match(/group-title="([^"]+)"/i);
                    const logoMatch = line.match(/tvg-logo="([^"]+)"/i);
                    const nameMatch = line.split(',')[1] || 'Sin nombre';
                    channel = {
                        group: groupMatch ? groupMatch[1] : 'Otros',
                        logo: logoMatch ? logoMatch[1] : '',
                        name: nameMatch,
                        url: ''
                    };
                    
                    // Extract series info if applicable
                    channel.seriesInfo = extractSeriesInfo(channel);
                } else if (line && !line.startsWith('#')) {
                    if (channel) {
                        channel.url = line;
                        allChannels.push(channel);
                        
                        if (!categories.has(channel.group)) {
                            categories.set(channel.group, []);
                        }
                        categories.get(channel.group).push(channel);
                        
                        // Si es una serie, agregar a la lista de series
                        if (channel.seriesInfo && channel.seriesInfo.isSeries) {
                            const existingSeries = allSeries.find(s => s.name === channel.seriesInfo.seriesName);
                            if (!existingSeries) {
                                allSeries.push({
                                    name: channel.seriesInfo.seriesName,
                                    episodes: [channel],
                                    group: channel.group,
                                    totalEpisodes: 1,
                                    totalSeasons: 1
                                });
                            } else {
                                existingSeries.episodes.push(channel);
                                existingSeries.totalEpisodes = existingSeries.episodes.length;
                                // Calcular temporadas √∫nicas
                                const uniqueSeasons = [...new Set(existingSeries.episodes.map(ep => ep.seriesInfo.season))];
                                existingSeries.totalSeasons = uniqueSeasons.length;
                            }
                        }
                        
                        channel = null;
                    }
                }
            }
            
            // Inicializar motor de b√∫squeda con los nuevos canales
            searchEngine = new SearchEngine(allChannels);
            
            renderCategories();
            renderChannels();
        }

        // Extract series information from channel name - MEJORADA
        function extractSeriesInfo(item) {
            const title = item.name.toLowerCase();
            
            // Detectar si es serie
            const isSeries = /s\d+\s*e\d+/i.test(title) || 
                            /temporada\s*\d+/i.test(title) || 
                            /season\s*\d+/i.test(title) || 
                            /cap[√≠i]tulo\s*\d+/i.test(title) || 
                            /episodio\s*\d+/i.test(title) ||
                            /chapter\s*\d+/i.test(title) ||
                            item.group?.toLowerCase().includes('serie');
            
            if (!isSeries) return null;
            
            // Extraer n√∫mero de temporada
            const seasonMatch = title.match(/s(\d+)/i) || 
                               title.match(/temporada\s*(\d+)/i) || 
                               title.match(/season\s*(\d+)/i);
            const season = seasonMatch ? parseInt(seasonMatch[1]) : 1;
            
            // Extraer n√∫mero de episodio
            const episodeMatch = title.match(/e(\d+)/i) || 
                                title.match(/cap[√≠i]tulo\s*(\d+)/i) || 
                                title.match(/episodio\s*(\d+)/i) || 
                                title.match(/chapter\s*(\d+)/i);
            const episode = episodeMatch ? parseInt(episodeMatch[1]) : 1;
            
            // Extraer nombre de la serie
            const seriesName = item.name
                .replace(/\s*s\d+\s*e\d+/i, '')
                .replace(/\s*temporada\s*\d+/i, '')
                .replace(/\s*cap[√≠i]tulo\s*\d+/i, '')
                .replace(/\s*episodio\s*\d+/i, '')
                .trim();
            
            return {
                seriesName,
                season,
                episode,
                isSeries: true
            };
        }

        // Render categories
        function renderCategories() {
            categoriesPanel.innerHTML = '';
            
            // Add Favorites category if there are favorites
            if (favorites.length > 0) {
                const favItem = document.createElement('div');
                favItem.className = `category-item ${showingFavorites ? 'active' : ''}`;
                favItem.innerHTML = `
                    <span class="category-name">‚≠ê Favoritos</span>
                    <span class="category-count">${favorites.length}</span>
                `;
                
                favItem.addEventListener('click', () => {
                    showingFavorites = true;
                    currentCategory = null;
                    searchActive = false;
                    searchInput.value = '';
                    renderCategories();
                    renderChannels();
                });
                
                categoriesPanel.appendChild(favItem);
            }
            
            // Add regular categories
            for (const [categoryName, channels] of categories) {
                const categoryItem = document.createElement('div');
                categoryItem.className = `category-item ${categoryName === currentCategory ? 'active' : ''}`;
                categoryItem.innerHTML = `
                    <span class="category-name">${categoryName}</span>
                    <span class="category-count">${channels.length}</span>
                `;
                
                categoryItem.addEventListener('click', () => {
                    showingFavorites = false;
                    currentCategory = categoryName;
                    searchActive = false;
                    searchInput.value = '';
                    renderCategories();
                    renderChannels();
                });
                
                categoriesPanel.appendChild(categoryItem);
            }
            
            // If no categories, select the first one
            if (categories.size > 0 && !currentCategory && !showingFavorites) {
                currentCategory = [...categories.keys()][0];
                renderCategories();
            }
        }

        // ===== RENDERIZADO OPTIMIZADO DE CANALES =====
        function renderChannels() {
            channelRenderer.clearContainer(channelsGridContainer);
            
            let channelsToShow = [];
            
            if (showingFavorites) {
                // Show favorite channels
                channelsToShow = allChannels.filter(channel => favorites.includes(channel.url));
            } else if (currentCategory && categories.has(currentCategory)) {
                // Show channels from selected category
                channelsToShow = categories.get(currentCategory);
            } else if (searchActive) {
                // Show search results
                const searchTerm = searchInput.value.toLowerCase();
                channelsToShow = searchEngine.search(searchTerm, { limit: 200 });
            }
            
            // Determine if we should use special grid for this category
            const isSpecialCategory = specialCategories.some(cat => 
                currentCategory && currentCategory.toLowerCase().includes(cat.toLowerCase())
            );
            
            // Create appropriate grid container
            const gridContainer = document.createElement('div');
            gridContainer.className = isSpecialCategory ? 'special-channels-grid' : 'channels-grid';
            channelsGridContainer.appendChild(gridContainer);
            
            // Renderizar canales por lotes para mejor rendimiento
            if (channelsToShow.length > 0) {
                channelRenderer.renderChannelsBatch(channelsToShow, gridContainer, isSpecialCategory);
            }
        }

        // ===== B√öSQUEDA GLOBAL OPTIMIZADA =====
        function setupGlobalSearch() {
            // B√∫squeda en vista principal
            searchInput.addEventListener('input', () => {
                const query = searchInput.value.trim();
                
                if (query === '') {
                    searchActive = false;
                    renderCategories();
                    renderChannels();
                } else {
                    searchActive = true;
                    // Usar b√∫squeda con debounce para mejor rendimiento
                    searchEngine.debouncedSearch(query, (results) => {
                        // Actualizar interfaz con resultados
                        const gridContainer = channelsGridContainer.querySelector('.channels-grid, .special-channels-grid');
                        if (gridContainer) {
                            channelRenderer.clearContainer(gridContainer);
                            const isSpecialCategory = gridContainer.classList.contains('special-channels-grid');
                            channelRenderer.renderChannelsBatch(results, gridContainer, isSpecialCategory);
                        }
                    }, 200);
                }
            });
            
            // ===== CORRECCI√ìN: B√öSQUEDA EN VISTA DE REPRODUCTOR =====
            playerSearchInput.addEventListener('input', () => {
                const query = playerSearchInput.value.trim();
                
                if (query === '') {
                    // Si no hay b√∫squeda, mostrar todos los canales de la categor√≠a actual
                    renderPlayerChannels();
                } else {
                    // Buscar en TODOS los canales (no solo en la categor√≠a actual)
                    const results = searchEngine.search(query, { limit: 100 });
                    
                    // Actualizar interfaz
                    channelRenderer.clearContainer(playerChannelsGrid);
                    const isSpecialCategory = specialCategories.some(cat => 
                        currentCategory && currentCategory.toLowerCase().includes(cat.toLowerCase())
                    );
                    channelRenderer.renderChannelsBatch(results, playerChannelsGrid, isSpecialCategory);
                }
            });
            
            // B√∫squeda global desde el reproductor
            globalSearchBtn.addEventListener('click', openGlobalSearchModal);
            
            // B√∫squeda en modal global
            globalSearchInput.addEventListener('input', () => {
                const query = globalSearchInput.value.trim();
                
                if (query === '') {
                    globalSearchResults.innerHTML = '<div class="search-result-item">Ingresa un t√©rmino de b√∫squeda...</div>';
                } else {
                    searchEngine.debouncedSearch(query, (results) => {
                        channelRenderer.clearContainer(globalSearchResults);
                        
                        if (results.length === 0) {
                            globalSearchResults.innerHTML = '<div class="search-result-item">No se encontraron resultados</div>';
                        } else {
                            results.forEach(channel => {
                                const resultElement = channelRenderer.createSearchResultElement(channel);
                                globalSearchResults.appendChild(resultElement);
                            });
                        }
                    }, 300);
                }
            });
        }

        // ===== FUNCIONES PARA MODAL DE B√öSQUEDA GLOBAL =====
        function openGlobalSearchModal() {
            globalSearchModal.style.display = 'flex';
            globalSearchInput.value = '';
            globalSearchInput.focus();
            globalSearchResults.innerHTML = '<div class="search-result-item">Ingresa un t√©rmino de b√∫squeda...</div>';
        }

        function closeGlobalSearchModal() {
            globalSearchModal.style.display = 'none';
            globalSearchInput.value = '';
        }

        // Toggle favorite
        function toggleFavorite(url) {
            if (favorites.includes(url)) {
                favorites = favorites.filter(f => f !== url);
            } else {
                favorites.push(url);
            }
            localStorage.setItem('iptv_favorites', JSON.stringify(favorites));
        }

        // ===== FUNCI√ìN PARA MARCAR CANAL COMO ACTIVO =====
        function markChannelAsActive(channelUrl) {
            // Buscar y marcar en la vista principal
            document.querySelectorAll('.channel-card, .special-channel-card').forEach(card => {
                const cardUrl = card.querySelector('.favorite-star')?.getAttribute('data-url');
                if (cardUrl === channelUrl) {
                    card.classList.add('active');
                    
                    // Agregar indicador de reproducci√≥n
                    const indicator = document.createElement('div');
                    indicator.className = 'playing-indicator';
                    card.style.position = 'relative';
                    card.appendChild(indicator);
                }
            });
        }

        // ===== CORRECCI√ìN: PLAY SERIES MEJORADO =====
        function playSeries(channel) {
            // Remover clase activa de todos los canales
            document.querySelectorAll('.channel-card.active, .special-channel-card.active').forEach(card => {
                card.classList.remove('active');
            });
            
            // Remover indicadores de reproducci√≥n existentes
            document.querySelectorAll('.playing-indicator').forEach(indicator => {
                indicator.remove();
            });
            
            currentPlayingChannel = channel;
            currentPlayingChannelUrl = channel.url;
            
            // Limpiar reproducci√≥n anterior
            if (videoPlayer) {
                videoPlayer.stop();
            }

            // Mostrar la vista del reproductor y ocultar el contenido principal
            playerView.style.display = 'flex';
            mainContent.style.display = 'none';

            // Mostrar controles de series
            seriesControls.style.display = 'flex';
            currentSeriesName = channel.seriesInfo.seriesName;
            seriesInfoDisplay.textContent = `${currentSeriesName} S${channel.seriesInfo.season.toString().padStart(2, '0')} E${channel.seriesInfo.episode.toString().padStart(2, '0')}`;
            
            // Buscar todos los episodios de la misma serie
            currentSeriesEpisodes = allChannels.filter(ch => 
                ch.seriesInfo && 
                ch.seriesInfo.isSeries && 
                ch.seriesInfo.seriesName === currentSeriesName
            );
            
            // Determinar temporada y episodio actual
            currentSeason = channel.seriesInfo.season || 1;
            const seasonEpisodes = currentSeriesEpisodes.filter(ep => ep.seriesInfo.season === currentSeason);
            currentEpisodeIndex = seasonEpisodes.findIndex(ep => ep.url === channel.url);
            
            // Agrupar episodios por temporada y mostrar selector
            const seasons = groupEpisodesBySeason(currentSeriesEpisodes);
            showSeasonSelector(seasons);
            
            // Mostrar episodios de la temporada actual
            showEpisodesForSeason(seasonEpisodes);
            
            // Mostrar otras series - M√ÅS RECOMENDACIONES
            showOtherSeries();
            
            // ===== CORRECCI√ìN: ACTUALIZAR LISTA DE CANALES CON LOS EPISODIOS DE LA SERIE =====
            renderPlayerChannelsWithSeries(currentSeriesEpisodes);

            // Marcar el episodio como activo
            markChannelAsActive(channel.url);

            // Reproducir el canal con el reproductor inteligente
            videoPlayer.play(channel.url, channel);
        }

        // Play channel normal
        function playChannel(channel) {
            // Remover clase activa de todos los canales
            document.querySelectorAll('.channel-card.active, .special-channel-card.active').forEach(card => {
                card.classList.remove('active');
            });
            
            // Remover indicadores de reproducci√≥n existentes
            document.querySelectorAll('.playing-indicator').forEach(indicator => {
                indicator.remove();
            });
            
            currentPlayingChannel = channel;
            currentPlayingChannelUrl = channel.url;
            
            // Limpiar reproducci√≥n anterior
            if (videoPlayer) {
                videoPlayer.stop();
            }

            // Mostrar la vista del reproductor y ocultar el contenido principal
            playerView.style.display = 'flex';
            mainContent.style.display = 'none';

            // Ocultar controles de series
            seriesControls.style.display = 'none';
            seasonsContainer.style.display = 'none';
            episodesContainer.style.display = 'none';
            otherSeriesContainer.style.display = 'none';
            
            // Marcar el canal como activo en ambas vistas
            markChannelAsActive(channel.url);
            
            // Cargar los canales de la misma categor√≠a en la vista del reproductor
            renderPlayerChannels();

            // Reproducir el canal con el reproductor inteligente
            videoPlayer.play(channel.url, channel);
        }

        // ===== NUEVA FUNCI√ìN: RENDERIZAR CANALES CON SERIES ESPEC√çFICAS =====
        function renderPlayerChannelsWithSeries(episodes) {
            channelRenderer.clearContainer(playerChannelsGrid);
            
            // Determinar si es categor√≠a especial
            const isSpecialCategory = specialCategories.some(cat => 
                currentCategory && currentCategory.toLowerCase().includes(cat.toLowerCase())
            );
            
            playerChannelsGrid.className = isSpecialCategory ? 'special-channels-grid' : 'channels-grid';
            
            // Renderizar episodios de la serie actual
            if (episodes.length > 0) {
                channelRenderer.renderChannelsBatch(episodes, playerChannelsGrid, isSpecialCategory);
            }
        }

        // ===== CORRECCI√ìN: FUNCI√ìN PARA MOSTRAR EPISODIOS MEJORADA =====
        function showEpisodesForSeason(episodes) {
            episodesScroll.innerHTML = '';
            episodesContainer.style.display = 'flex';

            episodes.forEach((episode, index) => {
                const isCurrent = episode.url === currentPlayingChannel.url;
                const episodeItem = document.createElement('div');
                episodeItem.className = `episode-item ${isCurrent ? 'current' : ''}`;
                episodeItem.textContent = `E${episode.seriesInfo?.episode || (index + 1)}`;
                episodeItem.title = episode.name;
                
                // ===== CORRECCI√ìN: REPRODUCIR EPISODIO DIRECTAMENTE AL HACER CLIC =====
                episodeItem.onclick = () => {
                    // Reproducir el episodio inmediatamente
                    videoPlayer.play(episode.url, episode);
                    currentPlayingChannel = episode;
                    currentEpisodeIndex = index;
                    
                    // Actualizar informaci√≥n de la serie
                    seriesInfoDisplay.textContent = `${currentSeriesName} S${currentSeason.toString().padStart(2, '0')} E${episode.seriesInfo.episode.toString().padStart(2, '0')}`;
                    
                    // Actualizar episodios activos
                    document.querySelectorAll('.episode-item').forEach(item => item.classList.remove('current'));
                    episodeItem.classList.add('current');
                    
                    // Actualizar estado activo del canal
                    markChannelAsActive(episode.url);
                };
                episodesScroll.appendChild(episodeItem);
            });
        }

        // ===== CORRECCI√ìN: FUNCI√ìN PARA MOSTRAR OTRAS SERIES MEJORADA =====
        function showOtherSeries() {
            otherSeriesScroll.innerHTML = '';
            otherSeriesContainer.style.display = 'flex';
            
            // Obtener otras series (excluyendo la actual) - M√ÅS SERIES
            let otherSeries = allSeries.filter(series => 
                series.name !== currentSeriesName
            );
            
            // Ordenar por n√∫mero de episodios (las m√°s populares primero)
            otherSeries.sort((a, b) => b.totalEpisodes - a.totalEpisodes);
            
            // Tomar hasta 12 series (m√°s recomendaciones)
            otherSeries = otherSeries.slice(0, 12);
            
            if (otherSeries.length === 0) {
                otherSeriesContainer.style.display = 'none';
                return;
            }
            
            otherSeries.forEach(series => {
                const seriesItem = document.createElement('div');
                seriesItem.className = 'other-series-item';
                
                seriesItem.innerHTML = `
                    <div class="other-series-name">${series.name}</div>
                    <div class="other-series-info">${series.totalSeasons} Temp ‚Ä¢ ${series.totalEpisodes} Eps</div>
                `;
                
                // ===== CORRECCI√ìN: AL SELECCIONAR UNA SERIE RECOMENDADA, MOSTRAR SUS EPISODIOS =====
                seriesItem.addEventListener('click', () => {
                    // Reproducir el primer episodio de la serie recomendada
                    const firstEpisode = series.episodes[0];
                    
                    // Actualizar variables globales para la nueva serie
                    currentSeriesName = series.name;
                    currentSeriesEpisodes = series.episodes;
                    currentSeason = firstEpisode.seriesInfo.season || 1;
                    
                    // Mostrar controles de la nueva serie
                    const seasons = groupEpisodesBySeason(currentSeriesEpisodes);
                    showSeasonSelector(seasons);
                    
                    const seasonEpisodes = seasons[currentSeason] || [];
                    showEpisodesForSeason(seasonEpisodes);
                    
                    // Actualizar lista de canales con los episodios de la nueva serie
                    renderPlayerChannelsWithSeries(currentSeriesEpisodes);
                    
                    // Reproducir el primer episodio
                    playSeries(firstEpisode);
                });
                
                otherSeriesScroll.appendChild(seriesItem);
            });
        }

        // Funci√≥n para mostrar el selector de temporadas - NUEVA FUNCI√ìN
        function showSeasonSelector(seasons) {
            seasonsScroll.innerHTML = '';
            seasonsContainer.style.display = 'flex';

            Object.keys(seasons).sort().forEach(seasonNum => {
                const seasonBtn = document.createElement('div');
                seasonBtn.className = `season-btn ${parseInt(seasonNum) === currentSeason ? 'active' : ''}`;
                seasonBtn.textContent = `Temporada ${seasonNum}`;
                seasonBtn.title = `${seasons[seasonNum].length} episodios`;
                
                seasonBtn.addEventListener('click', () => {
                    currentSeason = parseInt(seasonNum);
                    showEpisodesForSeason(seasons[currentSeason]);
                    
                    // Actualizar botones activos
                    document.querySelectorAll('.season-btn').forEach(btn => btn.classList.remove('active'));
                    seasonBtn.classList.add('active');
                });
                
                seasonsScroll.appendChild(seasonBtn);
            });
        }

        // Render channels in player view (versi√≥n normal)
        function renderPlayerChannels() {
            channelRenderer.clearContainer(playerChannelsGrid);
            
            let channelsToShow = [];
            
            if (currentCategory && categories.has(currentCategory)) {
                channelsToShow = categories.get(currentCategory);
            } else if (showingFavorites) {
                channelsToShow = allChannels.filter(channel => favorites.includes(channel.url));
            }
            
            // Aplicar b√∫squeda si hay t√©rmino
            const searchTerm = playerSearchInput.value.toLowerCase();
            if (searchTerm) {
                // Buscar en TODOS los canales (b√∫squeda global en el reproductor)
                channelsToShow = searchEngine.search(searchTerm, { limit: 100 });
            }
            
            // Determinar si es categor√≠a especial
            const isSpecialCategory = specialCategories.some(cat => 
                currentCategory && currentCategory.toLowerCase().includes(cat.toLowerCase())
            );
            
            playerChannelsGrid.className = isSpecialCategory ? 'special-channels-grid' : 'channels-grid';
            
            // Renderizar canales por lotes
            if (channelsToShow.length > 0) {
                channelRenderer.renderChannelsBatch(channelsToShow, playerChannelsGrid, isSpecialCategory);
            }
        }

        // Funci√≥n para agrupar episodios por temporada - NUEVA FUNCI√ìN
        function groupEpisodesBySeason(episodes) {
            const seasons = {};
            episodes.forEach(ep => {
                const seasonNum = ep.seriesInfo?.season || 1;
                seasons[seasonNum] = seasons[seasonNum] || [];
                seasons[seasonNum].push(ep);
            });
            Object.keys(seasons).forEach(season => {
                seasons[season].sort((a, b) => (a.seriesInfo?.episode || 0) - (b.seriesInfo?.episode || 0));
            });
            return seasons;
        }

        // Funci√≥n para encontrar el siguiente episodio - ACTUALIZADA
        function findNextEpisode(currentChannel) {
            if (!autoPlayEnabled || !currentSeriesEpisodes.length) return null;
            
            const seasons = groupEpisodesBySeason(currentSeriesEpisodes);
            const currentSeasonEpisodes = seasons[currentSeason] || [];
            
            if (currentEpisodeIndex !== -1 && currentEpisodeIndex < currentSeasonEpisodes.length - 1) {
                // Hay un siguiente episodio en la misma temporada
                return currentSeasonEpisodes[currentEpisodeIndex + 1];
            } else {
                // Buscar en la siguiente temporada
                const seasonKeys = Object.keys(seasons).map(Number).sort((a, b) => a - b);
                const currentSeasonIndex = seasonKeys.indexOf(currentSeason);
                
                if (currentSeasonIndex !== -1 && currentSeasonIndex < seasonKeys.length - 1) {
                    const nextSeason = seasonKeys[currentSeasonIndex + 1];
                    if (seasons[nextSeason] && seasons[nextSeason].length > 0) {
                        return seasons[nextSeason][0]; // Primer episodio de la siguiente temporada
                    }
                }
            }
            
            return null;
        }

        // Show main menu
        function showMainMenu() {
            if (videoPlayer) {
                videoPlayer.stop();
            }
            
            // Remover estado activo de todos los canales
            document.querySelectorAll('.channel-card.active, .special-channel-card.active').forEach(card => {
                card.classList.remove('active');
            });
            
            document.querySelectorAll('.playing-indicator').forEach(indicator => {
                indicator.remove();
            });
            
            currentPlayingChannel = null;
            currentPlayingChannelUrl = null;
            
            playerView.style.display = 'none';
            mainContent.style.display = 'flex';
            seriesControls.style.display = 'none';
        }

        // Series progress functions
        function getSeriesProgress(seriesName, season, episode) {
            if (seriesProgress[seriesName] && 
                seriesProgress[seriesName][season] && 
                seriesProgress[seriesName][season][episode]) {
                return seriesProgress[seriesName][season][episode];
            }
            return 0;
        }

        function updateSeriesProgress(seriesName, season, episode, progress = 1) {
            if (!seriesProgress[seriesName]) {
                seriesProgress[seriesName] = {};
            }
            
            if (!seriesProgress[seriesName][season]) {
                seriesProgress[seriesName][season] = {};
            }
            
            seriesProgress[seriesName][season][episode] = progress;
            localStorage.setItem('series_progress', JSON.stringify(seriesProgress));
        }

        // Event listeners
        settingsBtn.addEventListener('click', () => {
            settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
        });

        document.getElementById('show-favorites').addEventListener('click', () => {
            showingFavorites = true;
            currentCategory = null;
            searchActive = false;
            searchInput.value = '';
            renderCategories();
            renderChannels();
            settingsMenu.style.display = 'none';
        });

        document.getElementById('refresh-list').addEventListener('click', () => {
            // Usar el sistema inteligente para actualizar
            smartLoader.loadFromDrive();
            settingsMenu.style.display = 'none';
        });

        document.getElementById('load-m3u').addEventListener('click', () => {
            fileInput.click();
            settingsMenu.style.display = 'none';
        });

        // CORRECCI√ìN: Limpiar cache de forma silenciosa
        document.getElementById('clear-cache').addEventListener('click', () => {
            // Limpiar cache sin mostrar mensajes ni recargar
            smartLoader.cacheManager.clearCache();
            settingsMenu.style.display = 'none';
        });

        document.getElementById('close-settings').addEventListener('click', () => {
            settingsMenu.style.display = 'none';
        });

        backToMain.addEventListener('click', showMainMenu);

        // Configurar el toggle de reproducci√≥n autom√°tica
        autoPlayToggle.addEventListener('change', function() {
            autoPlayEnabled = this.checked;
            localStorage.setItem('autoPlayEnabled', autoPlayEnabled);
            if (videoPlayer) {
                videoPlayer.setAutoPlay(autoPlayEnabled);
            }
        });

        // Cerrar modal de b√∫squeda global
        closeGlobalSearchBtn.addEventListener('click', closeGlobalSearchModal);

        // Cerrar modal al hacer clic fuera
        globalSearchModal.addEventListener('click', (e) => {
            if (e.target === globalSearchModal) {
                closeGlobalSearchModal();
            }
        });

        // Cerrar modal con tecla Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && globalSearchModal.style.display === 'flex') {
                closeGlobalSearchModal();
            }
        });

        // Cargar preferencia de reproducci√≥n autom√°tica
        function loadAutoPlayPreference() {
            const saved = localStorage.getItem('autoPlayEnabled');
            autoPlayEnabled = saved !== null ? saved === 'true' : true;
            autoPlayToggle.checked = autoPlayEnabled;
        }

        // ===== NUEVO: MANEJO DE ARCHIVOS CON VERIFICACI√ìN DE TAMA√ëO SILENCIOSO =====
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                const file = this.files[0];
                
                // Verificar tama√±o del archivo silenciosamente
                if (file.size > MAX_FILE_SIZE) {
                    // Silenciosamente rechazar archivos demasiado grandes
                    this.value = '';
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    parseM3U(e.target.result);
                    
                    // Guardar en cache
                    const cacheData = {
                        allChannels: allChannels,
                        categories: Object.fromEntries(categories),
                        allSeries: allSeries,
                        timestamp: Date.now()
                    };
                    smartLoader.cacheManager.saveToCache(cacheData);
                };
                
                reader.onerror = function() {
                    console.error('Error al leer el archivo');
                };
                
                reader.readAsText(file);
            }
        });

        // Close settings menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!settingsMenu.contains(e.target) && e.target !== settingsBtn) {
                settingsMenu.style.display = 'none';
            }
        });

        // Inicializar el reproductor de video inteligente
        function initVideoPlayer() {
            const videoElement = document.getElementById('channel-player');
            videoPlayer = new SmartVideoPlayer(videoElement);
            videoPlayer.setAutoPlay(autoPlayEnabled);
        }

        // Special categories that should use special grid view
        const specialCategories = [
            'pel√≠culas', 'pel√≠cula', 'serie', 'movies', 'series', 'drama',
            'acci√≥n', 'action', 'terror', 'horror', 'anime',
            'animaci√≥n', 'dorama', 'doramas', 'netflix',
            'infantil', 'dramas', 'telenovela', 'child', 'narcos',
            'narcoseries', 'infantil', 'kids', 'vado', 'comedia'
        ];

        // Initialize the app
        async function init() {
            // Cargar datos de forma inteligente
            await smartLoader.loadData();
            
            loadAutoPlayPreference();
            setupGlobalSearch(); // Inicializar sistema de b√∫squeda
            initVideoPlayer(); // Inicializar reproductor inteligente
        }

        // Start the application
        init();
// ===== OCULTAR NOTIFICACIONES ESPEC√çFICAS =====

// 1. Ocultar indicador "Cargando" del reproductor (visualmente) pero mantener funcionalidad
function hidePlayerLoading() {
    const playerStatus = document.getElementById('player-status');
    if (playerStatus) {
        playerStatus.style.opacity = '0';
        playerStatus.style.visibility = 'hidden';
        // NO usar display: 'none' para que el sistema siga funcionando
    }
}

// 2. Ocultar notificaciones de cache, procesamiento y tama√±o de archivo (completamente)
function hideOtherNotifications() {
    // Estas s√≠ las ocultamos completamente
    const cacheStatus = document.getElementById('cache-status');
    const processingStatus = document.getElementById('processing-status');
    const fileWarning = document.getElementById('file-size-warning');
    
    if (cacheStatus) cacheStatus.style.display = 'none';
    if (processingStatus) processingStatus.style.display = 'none';
    if (fileWarning) fileWarning.style.display = 'none';
}

// 3. Funci√≥n principal que oculta solo lo no deseado
function hideUnwantedNotifications() {
    hidePlayerLoading();              // Oculta visualmente pero funciona  
    hideOtherNotifications();         // Oculta completamente
    // NOTA: NO ocultamos la notificaci√≥n del siguiente episodio
}

// 4. Modificar el sistema de cache para que no muestre notificaciones
function disableCacheNotifications() {
    if (window.smartLoader && window.smartLoader.showCacheStatus) {
        window.smartLoader.showCacheStatus = function() {
            return; // No mostrar notificaciones de cache
        };
    }
}

// 5. Ejecutar cuando se carga la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    hideUnwantedNotifications();
    disableCacheNotifications();
    
    // Observar cambios en el DOM
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList') {
                hideUnwantedNotifications();
            }
        });
    });
    
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
});

// 6. Ejecutar cuando se reproduce contenido
const originalPlayChannel = window.playChannel;
const originalPlaySeries = window.playSeries;

if (originalPlayChannel) {
    window.playChannel = function(channel) {
        originalPlayChannel.call(this, channel);
        setTimeout(hideUnwantedNotifications, 100);
    };
}

if (originalPlaySeries) {
    window.playSeries = function(channel) {
        originalPlaySeries.call(this, channel);
        setTimeout(hideUnwantedNotifications, 100);
    };
}

// 7. Ejecutar frecuentemente
setInterval(hideUnwantedNotifications, 500);

console.log('Ocultando: Cargando, Cache, Procesamiento y Tama√±o archivo');
// ===== CORRECCI√ìN: PREVENIR SCROLL HORIZONTAL NO DESEADO =====
function preventHorizontalScroll() {
    // Prevenir scroll horizontal con la rueda del mouse
    document.addEventListener('wheel', function(e) {
        if (e.deltaX !== 0) {
            e.preventDefault();
        }
    }, { passive: false });

    // Prevenir scroll horizontal con touch
    let startX;
    document.addEventListener('touchstart', function(e) {
        startX = e.touches[0].clientX;
    }, { passive: true });

    document.addEventListener('touchmove', function(e) {
        if (Math.abs(e.touches[0].clientX - startX) > Math.abs(e.touches[0].clientY - startY)) {
            e.preventDefault();
        }
    }, { passive: false });
}

// Ejecutar la correcci√≥n cuando se cargue la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    preventHorizontalScroll();
    
    // Aplicar estilos correctivos adicionales
    const style = document.createElement('style');
    style.textContent = `
        /* Forzar que no haya overflow horizontal */
        html, body {
            max-width: 100% !important;
            overflow-x: hidden !important;
            position: relative;
        }
        
        /* Asegurar que todos los contenedores principales respeten el ancho */
        .app-container, 
        #player-view, 
        #main-content,
        #series-controls,
        #player-channels-container {
            max-width: 100% !important;
            overflow-x: hidden !important;
        }
        
        /* Solo permitir scroll horizontal en los contenedores espec√≠ficos */
        .seasons-scroll,
        .episodes-scroll,
        .other-series-scroll {
            overflow-x: auto !important;
            overflow-y: hidden !important;
        }
    `;
    document.head.appendChild(style);
});
    </script>
</body>
</html> -->
        
        <div style="display:flex; justify-content:center; align-items:center; height:100vh; flex-direction:column; background:#000; color:white;">
            <h1>TVision Max - Aplicaci√≥n Principal</h1>
            <p>Tu aplicaci√≥n se cargar√° aqu√≠ despu√©s del efecto de presentaci√≥n</p>
            <p>En una implementaci√≥n real, aqu√≠ estar√≠a tu reproductor IPTV completo</p>
        </div>
    </div>

    <script>
        // ===== SCRIPT DEL EFECTO DE PRESENTACI√ìN =====
        document.addEventListener('DOMContentLoaded', function() {
            // Crear estrellas
            const starsContainer = document.getElementById('stars');
            const starCount = 150;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                const size = Math.random() * 3;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                star.style.left = `${Math.random() * 100}vw`;
                star.style.top = `${Math.random() * 100}vh`;
                star.style.animationDelay = `${Math.random() * 4}s`;
                
                starsContainer.appendChild(star);
            }
            
            // Crear part√≠culas decorativas
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                const size = Math.random() * 15 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.animationDelay = `${Math.random() * 15}s`;
                
                const duration = Math.random() * 10 + 10;
                particle.style.animationDuration = `${duration}s`;
                
                // Colores vibrantes para AMOLED
                const colors = ['rgba(0, 255, 136, 0.3)', 'rgba(255, 42, 109, 0.3)', 'rgba(0, 217, 255, 0.3)'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                particlesContainer.appendChild(particle);
            }
            
            // Simular progreso de carga
            const progressBar = document.getElementById('loading-progress');
            const loadingText = document.getElementById('loading-text');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = `${progress}%`;
                
                if (progress < 30) {
                    loadingText.textContent = "Cargando contenido...";
                } else if (progress < 60) {
                    loadingText.textContent = "Optimizando calidad de video...";
                } else if (progress < 90) {
                    loadingText.textContent = "Preparando interfaz...";
                } else {
                    loadingText.textContent = "¬°Listo! Iniciando TVision Max...";
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Transici√≥n a la aplicaci√≥n real
                    setTimeout(() => {
                        // Ocultar efecto de presentaci√≥n con animaci√≥n
                        document.getElementById('splash-container').style.opacity = '0';
                        document.getElementById('particles').style.opacity = '0';
                        document.querySelector('.mountain-background').style.opacity = '0';
                        document.querySelectorAll('.mountain-range').forEach(el => el.style.opacity = '0');
                        document.getElementById('stars').style.opacity = '0';
                        
                        // Mostrar aplicaci√≥n despu√©s de la animaci√≥n
                        setTimeout(() => {
                            document.getElementById('splash-container').style.display = 'none';
                            document.getElementById('particles').style.display = 'none';
                            document.querySelector('.mountain-background').style.display = 'none';
                            document.querySelectorAll('.mountain-range').forEach(el => el.style.display = 'none');
                            document.getElementById('stars').style.display = 'none';
                            
                            // Mostrar la aplicaci√≥n
                            document.getElementById('app-container').style.display = 'block';
                            
                            // Cambiar el fondo al tema de la aplicaci√≥n
                            document.body.style.background = '#000000';
                            
                            // Inicializar la aplicaci√≥n (aqu√≠ se cargar√≠a tu aplicaci√≥n)
                            console.log('TVision Max - Aplicaci√≥n lista para usar');
                            
                        }, 1000);
                    }, 1000);
                }
            }, 300);
        });
    </script>
</body>
</html>